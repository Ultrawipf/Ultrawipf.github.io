<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Open FFBoard: audio_device.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_blue_128.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Open FFBoard
   </div>
   <div id="projectbrief">Open source force feedback firmware</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('audio__device_8c_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">audio_device.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="audio__device_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* </span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * The MIT License (MIT)</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (c) 2020 Reinhard Panhuber, Jerzy Kasenberg</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Permission is hereby granted, free of charge, to any person obtaining a copy</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * of this software and associated documentation files (the &quot;Software&quot;), to deal</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * in the Software without restriction, including without limitation the rights</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * copies of the Software, and to permit persons to whom the Software is</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * furnished to do so, subject to the following conditions:</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * The above copyright notice and this permission notice shall be included in</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * all copies or substantial portions of the Software.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * THE SOFTWARE.</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * This file is part of the TinyUSB stack.</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * This driver supports at most one out EP, one in EP, one control EP, and one feedback EP and one alternative interface other than zero. Hence, only one input terminal and one output terminal are support, if you need more adjust the driver!</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * It supports multiple TX and RX channels.</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> * In case you need more alternate interfaces, you need to define additional defines for this specific alternate interface. Just define them and set them in the set_interface function.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> * */</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="tusb__option_8h.html">tusb_option.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#if (TUSB_OPT_DEVICE_ENABLED &amp;&amp; CFG_TUD_AUDIO)</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">//--------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">// INCLUDE</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">//--------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="audio__device_8h.html">audio_device.h</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="audio_8h.html">class/audio/audio.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="usbd__pvt_8h.html">device/usbd_pvt.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">//--------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">// MACRO CONSTANT TYPEDEF</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">//--------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_IN &amp;&amp; CFG_TUD_AUDIO_TX_FIFO_SIZE</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#ifndef CFG_TUD_AUDIO_TX_FIFO_COUNT</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#define CFG_TUD_AUDIO_TX_FIFO_COUNT CFG_TUD_AUDIO_N_CHANNELS_TX</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_OUT &amp;&amp; CFG_TUD_AUDIO_RX_FIFO_SIZE</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#ifndef CFG_TUD_AUDIO_RX_FIFO_COUNT</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#define CFG_TUD_AUDIO_RX_FIFO_COUNT CFG_TUD_AUDIO_N_CHANNELS_RX</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html">   62</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;{</div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#a26eadf826c08e25eced602925238224b">   64</a></span>&#160;  uint8_t <a class="code" href="structaudiod__interface__t.html#a26eadf826c08e25eced602925238224b">rhport</a>;</div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#a6447ba0d0c6f3c0387556a9d0b35f22e">   65</a></span>&#160;  uint8_t <span class="keyword">const</span> * <a class="code" href="structaudiod__interface__t.html#a6447ba0d0c6f3c0387556a9d0b35f22e">p_desc</a>;       <span class="comment">// Pointer pointing to Standard AC Interface Descriptor(4.7.1) - Audio Control descriptor defining audio function</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_IN</span></div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#a6d80c8df994755d6bda4b74c5feb4c55">   68</a></span>&#160;  uint8_t <a class="code" href="structaudiod__interface__t.html#a6d80c8df994755d6bda4b74c5feb4c55">ep_in</a>;                <span class="comment">// Outgoing (out of uC) audio data EP.</span></div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#a2d66b7cda27cdb10981693940bff5887">   69</a></span>&#160;  uint16_t <a class="code" href="structaudiod__interface__t.html#a2d66b7cda27cdb10981693940bff5887">epin_buf_cnt</a>;        <span class="comment">// Count filling status of EP in buffer - this is a shared state currently and is intended to be removed once EP buffers can be implemented as FIFOs!</span></div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#a4822da41b42dcf15bf73364bea0565f2">   70</a></span>&#160;  uint8_t <a class="code" href="structaudiod__interface__t.html#a4822da41b42dcf15bf73364bea0565f2">ep_in_as_intf_num</a>;    <span class="comment">// Corresponding Standard AS Interface Descriptor (4.9.1) belonging to output terminal to which this EP belongs - 0 is invalid (this fits to UAC2 specification since AS interfaces can not have interface number equal to zero)</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_OUT</span></div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#ad6374eb5e7c83a8dec7a16bf7d61f199">   74</a></span>&#160;  uint8_t <a class="code" href="structaudiod__interface__t.html#ad6374eb5e7c83a8dec7a16bf7d61f199">ep_out</a>;               <span class="comment">// Incoming (into uC) audio data EP.</span></div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#a0b6985b3138bea86dafe037071eff704">   75</a></span>&#160;  uint8_t <a class="code" href="structaudiod__interface__t.html#a0b6985b3138bea86dafe037071eff704">ep_out_as_intf_num</a>;   <span class="comment">// Corresponding Standard AS Interface Descriptor (4.9.1) belonging to input terminal to which this EP belongs - 0 is invalid (this fits to UAC2 specification since AS interfaces can not have interface number equal to zero)</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_ENABLE_FEEDBACK_EP</span></div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#a79b64e83989a2821c496dfad732563ef">   78</a></span>&#160;  uint8_t <a class="code" href="structaudiod__interface__t.html#a79b64e83989a2821c496dfad732563ef">ep_fb</a>;                <span class="comment">// Feedback EP.</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_INT_CTR_EPSIZE_IN</span></div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#aabf94bbb03fb61a7f821cb3b19eee159">   84</a></span>&#160;  uint8_t <a class="code" href="structaudiod__interface__t.html#aabf94bbb03fb61a7f821cb3b19eee159">ep_int_ctr</a>;           <span class="comment">// Audio control interrupt EP.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_N_AS_INT</span></div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#a6f525368d2d6d9cf8416edc2a067c3b8">   88</a></span>&#160;  uint8_t altSetting[CFG_TUD_AUDIO_N_AS_INT];   <span class="comment">// We need to save the current alternate setting this way, because it is possible that there are AS interfaces which do not have an EP!</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="comment">/*------------- From this point, data is not cleared by bus reset -------------*/</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="comment">// Buffer for control requests</span></div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#a9ee6b0d8769bd26fb7d14414b54ac8eb">   93</a></span>&#160;  CFG_TUSB_MEM_ALIGN uint8_t ctrl_buf[CFG_TUD_AUDIO_CTRL_BUF_SIZE];</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">// FIFO</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_IN &amp;&amp; CFG_TUD_AUDIO_TX_FIFO_SIZE</span></div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#abae241b79effc5e4a34753cb5873fc09">   97</a></span>&#160;  <a class="code" href="structtu__fifo__t.html">tu_fifo_t</a> tx_ff[CFG_TUD_AUDIO_TX_FIFO_COUNT];</div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#ab86fe42db2fa6ef7d85918ecd302eaec">   98</a></span>&#160;  CFG_TUSB_MEM_ALIGN uint8_t tx_ff_buf[CFG_TUD_AUDIO_TX_FIFO_COUNT][CFG_TUD_AUDIO_TX_FIFO_SIZE];</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#if CFG_FIFO_MUTEX</span></div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#aefbedc5757f6a36a611d84c54a787955">  100</a></span>&#160;  <a class="code" href="osal__freertos_8h.html#a5930f7a2cc6f2bb374dea58f7256f943">osal_mutex_def_t</a> tx_ff_mutex[CFG_TUD_AUDIO_TX_FIFO_COUNT];</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_OUT &amp;&amp; CFG_TUD_AUDIO_RX_FIFO_SIZE</span></div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#ab0d6da4e705a63123e4d1170157231ff">  105</a></span>&#160;  <a class="code" href="structtu__fifo__t.html">tu_fifo_t</a> rx_ff[CFG_TUD_AUDIO_RX_FIFO_COUNT];</div>
<div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#a4803234e5365a68c80be0e704823bef1">  106</a></span>&#160;  CFG_TUSB_MEM_ALIGN uint8_t rx_ff_buf[CFG_TUD_AUDIO_RX_FIFO_COUNT][CFG_TUD_AUDIO_RX_FIFO_SIZE];</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor">#if CFG_FIFO_MUTEX</span></div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#ac88cb4873bc4b6b55341a7356d8c74a1">  108</a></span>&#160;  <a class="code" href="osal__freertos_8h.html#a5930f7a2cc6f2bb374dea58f7256f943">osal_mutex_def_t</a> rx_ff_mutex[CFG_TUD_AUDIO_RX_FIFO_COUNT];</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_INT_CTR_EPSIZE_IN</span></div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#aa718168a12b7112d4d9a4a6847d580e0">  113</a></span>&#160;  <a class="code" href="structtu__fifo__t.html">tu_fifo_t</a> <a class="code" href="structaudiod__interface__t.html#aa718168a12b7112d4d9a4a6847d580e0">int_ctr_ff</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#a7a101747bf0a4cc519fc472c4fa683ef">  114</a></span>&#160;  CFG_TUSB_MEM_ALIGN uint8_t int_ctr_ff_buf[CFG_TUD_AUDIO_INT_CTR_BUFSIZE];</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor">#if CFG_FIFO_MUTEX</span></div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#a4d4468ca5402d897306f260a9d8fda16">  116</a></span>&#160;  <a class="code" href="osal__freertos_8h.html#a5930f7a2cc6f2bb374dea58f7256f943">osal_mutex_def_t</a> <a class="code" href="structaudiod__interface__t.html#a4d4468ca5402d897306f260a9d8fda16">int_ctr_ff_mutex</a>;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">// Endpoint Transfer buffers</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_OUT</span></div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#a8cabd941c5539cb1f0a9b0b7621d4ae9">  122</a></span>&#160;  CFG_TUSB_MEM_ALIGN uint8_t epout_buf[CFG_TUD_AUDIO_EPSIZE_OUT];        <span class="comment">// Bigger makes no sense for isochronous EP&#39;s (but technically possible here)</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_ENABLE_FEEDBACK_EP</span></div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#aca1971fc878ae5d0725d81a67ce83e29">  125</a></span>&#160;  uint32_t <a class="code" href="structaudiod__interface__t.html#aca1971fc878ae5d0725d81a67ce83e29">fb_val</a>;                                                       <span class="comment">// Feedback value for asynchronous mode (in 16.16 format).</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_IN</span></div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#a1e7250e29ffe799e7e614e7334299471">  131</a></span>&#160;  CFG_TUSB_MEM_ALIGN uint8_t epin_buf[CFG_TUD_AUDIO_EPSIZE_IN];         <span class="comment">// Bigger makes no sense for isochronous EP&#39;s (but technically possible here)</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_INT_CTR_EPSIZE_IN</span></div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="structaudiod__interface__t.html#a7847aaafa32aa3ef13f6b58fa747467b">  135</a></span>&#160;  CFG_TUSB_MEM_ALIGN uint8_t ep_int_ctr_buf[CFG_TUD_AUDIO_INT_CTR_EPSIZE_IN];</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;} <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="preprocessor">#define ITF_MEM_RESET_SIZE   offsetof(audiod_interface_t, ctrl_buf)</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">//--------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">// INTERNAL OBJECT &amp; FUNCTION DECLARATION</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">//--------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">  145</a></span>&#160;CFG_TUSB_MEM_SECTION <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a> <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[CFG_TUD_AUDIO];</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="keyword">extern</span> <span class="keyword">const</span> uint16_t <a class="code" href="audio__device_8c.html#ac36d4c519e458a99d79a121eac59a5df">tud_audio_desc_lengths</a>[];</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_OUT</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#abc179677384302d76886a0144b332b14">audio_rx_done_type_I_pcm_ff_cb</a>(uint8_t rhport, <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>* audio, uint8_t * buffer, uint16_t bufsize);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_IN</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#a0422a57de30423fd529fd73cf3530a2b">audiod_tx_done_type_I_pcm_ff_cb</a>(uint8_t rhport, <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>* audio);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#a95893a2600798eec6df171e4cd0b6e70">audiod_get_interface</a>(uint8_t rhport, <a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_control_request_t</a> <span class="keyword">const</span> * p_request);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#a7abe0efec0cf613405fa2995d15b2c8e">audiod_set_interface</a>(uint8_t rhport, <a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_control_request_t</a> <span class="keyword">const</span> * p_request);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#addcbf82fb684c80d4f2c22d0833fce44">audiod_get_AS_interface_index</a>(uint8_t itf, uint8_t *idxDriver, uint8_t *idxItf, uint8_t <span class="keyword">const</span> **pp_desc_int);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#a965631c42a2f162557bea4ef61ce0ffa">audiod_verify_entity_exists</a>(uint8_t itf, uint8_t entityID, uint8_t *idxDriver);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#afaa85901b20e8953a0c55b2ed688466c">audiod_verify_itf_exists</a>(uint8_t itf, uint8_t *idxDriver);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#ad19beb67377f7e649bf5cbfc3bbdca9c">audiod_verify_ep_exists</a>(uint8_t ep, uint8_t *idxDriver);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#gab6711bd57901e11458814bee53ab8d70">  165</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#gab6711bd57901e11458814bee53ab8d70">tud_audio_n_mounted</a>(uint8_t itf)</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;{</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>* audio = &amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[itf];</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_OUT</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordflow">if</span> (audio-&gt;<a class="code" href="structaudiod__interface__t.html#ad6374eb5e7c83a8dec7a16bf7d61f199">ep_out</a> == 0)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_IN</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordflow">if</span> (audio-&gt;<a class="code" href="structaudiod__interface__t.html#a6d80c8df994755d6bda4b74c5feb4c55">ep_in</a> == 0)</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_INT_CTR_EPSIZE_IN</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordflow">if</span> (audio-&gt;<a class="code" href="structaudiod__interface__t.html#aabf94bbb03fb61a7f821cb3b19eee159">ep_int_ctr</a> == 0)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_ENABLE_FEEDBACK_EP</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordflow">if</span> (audio-&gt;<a class="code" href="structaudiod__interface__t.html#a79b64e83989a2821c496dfad732563ef">ep_fb</a> == 0)</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">//--------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">// READ API</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">//--------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_OUT &amp;&amp; CFG_TUD_AUDIO_RX_FIFO_SIZE</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_RX_FIFO_COUNT &gt; 1</span></div>
<div class="line"><a name="l00206"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#gad7616637a2b3366a58397aabbf4f4bda">  206</a></span>&#160;uint16_t <a class="code" href="group___a_u_d_i_o___serial___device.html#gad7616637a2b3366a58397aabbf4f4bda">tud_audio_n_available</a>(uint8_t itf, uint8_t channelId)</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;{</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  TU_VERIFY(channelId &lt; CFG_TUD_AUDIO_N_CHANNELS_RX);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__group__fifo.html#ga0653c4e3af5b0b2766ff72264f5836b7">tu_fifo_count</a>(&amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[itf].rx_ff[channelId]);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;}</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#gad07a937de93ff3ecf9ba8cda61a5d669">  212</a></span>&#160;uint16_t <a class="code" href="group___a_u_d_i_o___serial___device.html#gad07a937de93ff3ecf9ba8cda61a5d669">tud_audio_n_read</a>(uint8_t itf, uint8_t channelId, <span class="keywordtype">void</span>* buffer, uint16_t bufsize)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;{</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  TU_VERIFY(channelId &lt; CFG_TUD_AUDIO_N_CHANNELS_RX);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__group__fifo.html#gac2550100e64724b1c1e29fe59735499d">tu_fifo_read_n</a>(&amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[itf].rx_ff[channelId], buffer, bufsize);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;}</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#gab03f527ee1d9292add5c419a47be4eeb">  218</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#gab03f527ee1d9292add5c419a47be4eeb">tud_audio_n_read_flush</a> (uint8_t itf, uint8_t channelId)</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;{</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  TU_VERIFY(channelId &lt; CFG_TUD_AUDIO_N_CHANNELS_RX, );</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <a class="code" href="group__group__fifo.html#gaf629a02b7f0b2dc380bfdc1d8ca05723">tu_fifo_clear</a>(&amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[itf].rx_ff[channelId]);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;}</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#ga8d7d83a46f54bb514b2caa46022ed962">  224</a></span>&#160;uint16_t <a class="code" href="group___a_u_d_i_o___serial___device.html#gad7616637a2b3366a58397aabbf4f4bda">tud_audio_n_available</a>(uint8_t itf)</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;{</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__group__fifo.html#ga0653c4e3af5b0b2766ff72264f5836b7">tu_fifo_count</a>(&amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[itf].rx_ff[0]);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;}</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#ga9e0547105391cc4d9fee91a433b7ab1b">  229</a></span>&#160;uint16_t <a class="code" href="group___a_u_d_i_o___serial___device.html#gad07a937de93ff3ecf9ba8cda61a5d669">tud_audio_n_read</a>(uint8_t itf, <span class="keywordtype">void</span>* buffer, uint16_t bufsize)</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;{</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__group__fifo.html#gac2550100e64724b1c1e29fe59735499d">tu_fifo_read_n</a>(&amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[itf].rx_ff[0], buffer, bufsize);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;}</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#ga6580085d7916b97807a3f77a31705d33">  234</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#gab03f527ee1d9292add5c419a47be4eeb">tud_audio_n_read_flush</a> (uint8_t itf)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;{</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <a class="code" href="group__group__fifo.html#gaf629a02b7f0b2dc380bfdc1d8ca05723">tu_fifo_clear</a>(&amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[itf].rx_ff[0]);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160; </div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_INT_CTR_EPSIZE_IN</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#ga0148a0cf485e6790ef7a51551ae8f550">  243</a></span>&#160;uint16_t <a class="code" href="group___a_u_d_i_o___serial___device.html#ga0148a0cf485e6790ef7a51551ae8f550">tud_audio_int_ctr_n_available</a>(uint8_t itf)</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;{</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__group__fifo.html#ga0653c4e3af5b0b2766ff72264f5836b7">tu_fifo_count</a>(&amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[itf].int_ctr_ff);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;}</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#gad5b147a3a0493d9747aea7045b2b348a">  248</a></span>&#160;uint16_t <a class="code" href="group___a_u_d_i_o___serial___device.html#gad5b147a3a0493d9747aea7045b2b348a">tud_audio_int_ctr_n_read</a>(uint8_t itf, <span class="keywordtype">void</span>* buffer, uint16_t bufsize)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;{</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__group__fifo.html#gac2550100e64724b1c1e29fe59735499d">tu_fifo_read_n</a>(&amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[itf].int_ctr_ff, buffer, bufsize);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;}</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#ga99bd34b9716983f4d843257f867d8346">  253</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#ga99bd34b9716983f4d843257f867d8346">tud_audio_int_ctr_n_read_flush</a> (uint8_t itf)</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;{</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <a class="code" href="group__group__fifo.html#gaf629a02b7f0b2dc380bfdc1d8ca05723">tu_fifo_clear</a>(&amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[itf].int_ctr_ff);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;}</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">// This function is called once something is received by USB and is responsible for decoding received stream into audio channels.</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">// If you prefer your own (more efficient) implementation suiting your purpose set CFG_TUD_AUDIO_RX_FIFO_SIZE = 0.</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_OUT</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno"><a class="line" href="audio__device_8c.html#a2f20fe78d812f93eea18c622836a73a2">  265</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#a2f20fe78d812f93eea18c622836a73a2">audio_rx_done_cb</a>(uint8_t rhport, <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>* audio, uint8_t* buffer, uint16_t bufsize)</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;{</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordflow">switch</span> (CFG_TUD_AUDIO_FORMAT_TYPE_RX)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">case</span> AUDIO_FORMAT_TYPE_UNDEFINED:</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="comment">// INDIVIDUAL DECODING PROCEDURE REQUIRED HERE!</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      TU_LOG2(<span class="stringliteral">&quot;  Desired CFG_TUD_AUDIO_FORMAT encoding not implemented!\r\n&quot;</span>);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      TU_BREAKPOINT();</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">case</span> AUDIO_FORMAT_TYPE_I:</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="keywordflow">switch</span> (CFG_TUD_AUDIO_FORMAT_TYPE_I_RX)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">case</span> AUDIO_DATA_FORMAT_TYPE_I_PCM:</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_RX_FIFO_SIZE</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;          TU_VERIFY(<a class="code" href="audio__device_8c.html#abc179677384302d76886a0144b332b14">audio_rx_done_type_I_pcm_ff_cb</a>(rhport, audio, buffer, bufsize));</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="preprocessor">#error YOUR DECODING AND BUFFERING IS REQUIRED HERE!</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;          <span class="comment">// DESIRED CFG_TUD_AUDIO_FORMAT_TYPE_I_RX NOT IMPLEMENTED!</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;          TU_LOG2(<span class="stringliteral">&quot;  Desired CFG_TUD_AUDIO_FORMAT_TYPE_I_RX encoding not implemented!\r\n&quot;</span>);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;          TU_BREAKPOINT();</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;          <span class="comment">// Desired CFG_TUD_AUDIO_FORMAT_TYPE_RX not implemented!</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;          TU_LOG2(<span class="stringliteral">&quot;  Desired CFG_TUD_AUDIO_FORMAT_TYPE_RX not implemented!\r\n&quot;</span>);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;          TU_BREAKPOINT();</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  }</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="comment">// Call a weak callback here - a possibility for user to get informed RX was completed</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#ga9b230f36e4810b0651d51254547006f8">tud_audio_rx_done_cb</a>) TU_VERIFY(<a class="code" href="group___a_u_d_i_o___serial___device.html#ga9b230f36e4810b0651d51254547006f8">tud_audio_rx_done_cb</a>(rhport, buffer, bufsize));</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;}</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="preprocessor">#endif </span><span class="comment">//CFG_TUD_AUDIO_EPSIZE_OUT</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">// The following functions are used in case CFG_TUD_AUDIO_RX_FIFO_SIZE != 0</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_RX_FIFO_SIZE</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_RX_FIFO_COUNT &gt; 1</span></div>
<div class="line"><a name="l00314"></a><span class="lineno"><a class="line" href="audio__device_8c.html#abc179677384302d76886a0144b332b14">  314</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#abc179677384302d76886a0144b332b14">audio_rx_done_type_I_pcm_ff_cb</a>(uint8_t rhport, <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>* audio, uint8_t * buffer, uint16_t bufsize)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;{</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  (void) rhport;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="comment">// We expect to get a multiple of CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_RX * CFG_TUD_AUDIO_N_CHANNELS_RX per channel</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordflow">if</span> (bufsize % (CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_RX * CFG_TUD_AUDIO_N_CHANNELS_RX) != 0)</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  uint8_t chId = 0;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  uint16_t cnt;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_RX == 1</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  uint8_t sample = 0;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor">#elif CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_RX == 2</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  uint16_t sample = 0;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  uint32_t sample = 0;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keywordflow">for</span>(cnt = 0; cnt &lt; bufsize; cnt += CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_RX)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">// Let alignment problems be handled by memcpy</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    memcpy(&amp;sample, &amp;buffer[cnt], CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_RX);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="group__group__fifo.html#ga87bb1cdf2a8fa5c16e12dded661c8890">tu_fifo_write_n</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#ab0d6da4e705a63123e4d1170157231ff">rx_ff</a>[chId++], &amp;sample, CFG_TUD_AUDIO_RX_ITEMSIZE) != CFG_TUD_AUDIO_RX_ITEMSIZE)</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <span class="comment">// Buffer overflow</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">if</span> (chId == CFG_TUD_AUDIO_N_CHANNELS_RX)</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      chId = 0;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;}</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#abc179677384302d76886a0144b332b14">audio_rx_done_type_I_pcm_ff_cb</a>(uint8_t rhport, <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a> *audio, uint8_t *buffer, uint16_t bufsize)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;{</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  (void) rhport;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="comment">// We expect to get a multiple of CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_RX * CFG_TUD_AUDIO_N_CHANNELS_RX per channel</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordflow">if</span> (bufsize % (CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_RX * CFG_TUD_AUDIO_N_CHANNELS_RX) != 0)</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <a class="code" href="group__group__fifo.html#ga87bb1cdf2a8fa5c16e12dded661c8890">tu_fifo_write_n</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#ab0d6da4e705a63123e4d1170157231ff">rx_ff</a>[0], buffer, bufsize);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;}</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="preprocessor">#endif </span><span class="comment">// CFG_TUD_AUDIO_RX_FIFO_COUNT &gt; 1</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="preprocessor">#endif </span><span class="comment">//CFG_TUD_AUDIO_RX_FIFO_SIZE</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">//--------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">// WRITE API</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">//--------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_IN</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="preprocessor">#if !CFG_TUD_AUDIO_TX_FIFO_SIZE</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">/*  This function is intended for later use once EP buffers (at least for ISO EPs) are implemented as ring buffers</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">uint16_t tud_audio_n_write_ep_in_buffer(uint8_t itf, const void * data, uint16_t len)</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">{</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">  audiod_interface_t* audio = &amp;_audiod_itf[itf];</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">  if (audio-&gt;p_desc == NULL) {</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">    return 0;</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">  }</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">  // THIS IS A CRITICAL SECTION - audio-&gt;epin_buf_cnt MUST NOT BE MODIFIED FROM HERE - happens if audiod_tx_done_cb() is executed in between!</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">  // FOR SINGLE THREADED OPERATION:</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">  // AS LONG AS THIS FUNCTION IS NOT EXECUTED WITHIN AN INTERRUPT ALL IS FINE!</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">  // Determine free space</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">  uint16_t free = CFG_TUD_AUDIO_EPSIZE_IN - audio-&gt;epin_buf_cnt;</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">  // Clip length if needed</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">  if (len &gt; free) len = free;</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">  // Write data</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">  memcpy((void *) &amp;audio-&gt;epin_buf[audio-&gt;epin_buf_cnt], data, len);</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">  audio-&gt;epin_buf_cnt += len;</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">  // Return number of bytes written</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">  return len;</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">}</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_TX_FIFO_COUNT == 1</span></div>
<div class="line"><a name="l00417"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#ga6f4a5ca886d0b4c550d6b3c21cee2ec6">  417</a></span>&#160;uint16_t <a class="code" href="group___a_u_d_i_o___serial___device.html#ga6f4a5ca886d0b4c550d6b3c21cee2ec6">tud_audio_n_write</a>(uint8_t itf, <span class="keywordtype">void</span> <span class="keyword">const</span>* data, uint16_t len)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;{</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  {</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>* audio = &amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[itf];</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">if</span> (audio-&gt;<a class="code" href="structaudiod__interface__t.html#a6447ba0d0c6f3c0387556a9d0b35f22e">p_desc</a> == NULL)</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__group__fifo.html#ga87bb1cdf2a8fa5c16e12dded661c8890">tu_fifo_write_n</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#abae241b79effc5e4a34753cb5873fc09">tx_ff</a>[0], data, len);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  }</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;}</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00429"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#gad0f44df878e286c7378041d924579958">  429</a></span>&#160;uint16_t <a class="code" href="group___a_u_d_i_o___serial___device.html#ga6f4a5ca886d0b4c550d6b3c21cee2ec6">tud_audio_n_write</a>(uint8_t itf, uint8_t channelId, <span class="keyword">const</span> <span class="keywordtype">void</span> * data, uint16_t len)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;{</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>* audio = &amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[itf];</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keywordflow">if</span> (audio-&gt;<a class="code" href="structaudiod__interface__t.html#a6447ba0d0c6f3c0387556a9d0b35f22e">p_desc</a> == NULL) {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__group__fifo.html#ga87bb1cdf2a8fa5c16e12dded661c8890">tu_fifo_write_n</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#abae241b79effc5e4a34753cb5873fc09">tx_ff</a>[channelId], data, len);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;}</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#ab7f1ef914fa407dc1bacf820eadd97a1">audiod_tx_done_cb</a>(uint8_t rhport, <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>* audio, uint16_t * n_bytes_copied);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#ga701b1052def1f2597f7dc03127cbf4b6">  442</a></span>&#160;uint16_t <a class="code" href="group___a_u_d_i_o___serial___device.html#ga701b1052def1f2597f7dc03127cbf4b6">tud_audio_n_write_flush</a>(uint8_t itf)</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;{</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a> *audio = &amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[itf];</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordflow">if</span> (audio-&gt;<a class="code" href="structaudiod__interface__t.html#a6447ba0d0c6f3c0387556a9d0b35f22e">p_desc</a> == NULL) {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  uint16_t n_bytes_copied;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  TU_VERIFY(<a class="code" href="audio__device_8c.html#ab7f1ef914fa407dc1bacf820eadd97a1">audiod_tx_done_cb</a>(audio-&gt;<a class="code" href="structaudiod__interface__t.html#a26eadf826c08e25eced602925238224b">rhport</a>, audio, &amp;n_bytes_copied));</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordflow">return</span> n_bytes_copied;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;}</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_INT_CTR_EPSIZE_IN &gt; 0</span></div>
<div class="line"><a name="l00458"></a><span class="lineno"><a class="line" href="audio__device_8c.html#a4bb141bbb7dceb4722cde99885f6bdd3">  458</a></span>&#160;uint32_t <a class="code" href="audio__device_8c.html#a4bb141bbb7dceb4722cde99885f6bdd3">tud_audio_int_ctr_n_write</a>(uint8_t itf, uint8_t <span class="keyword">const</span>* buffer, uint32_t bufsize)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;{</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>* audio = &amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[itf];</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordflow">if</span> (audio-&gt;<a class="code" href="structaudiod__interface__t.html#a6447ba0d0c6f3c0387556a9d0b35f22e">p_desc</a> == NULL) {</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__group__fifo.html#ga87bb1cdf2a8fa5c16e12dded661c8890">tu_fifo_write_n</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#aa718168a12b7112d4d9a4a6847d580e0">int_ctr_ff</a>, buffer, bufsize);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;}</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160; </div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">// This function is called once a transmit of an audio packet was successfully completed. Here, we encode samples and place it in IN EP&#39;s buffer for next transmission.</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">// If you prefer your own (more efficient) implementation suiting your purpose set CFG_TUD_AUDIO_TX_FIFO_SIZE = 0 and use tud_audio_n_write_ep_in_buffer() (NOT IMPLEMENTED SO FAR).</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">// n_bytes_copied - Informs caller how many bytes were loaded. In case n_bytes_copied = 0, a ZLP is scheduled to inform host no data is available for current frame.</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_IN</span></div>
<div class="line"><a name="l00475"></a><span class="lineno"><a class="line" href="audio__device_8c.html#ab7f1ef914fa407dc1bacf820eadd97a1">  475</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#ab7f1ef914fa407dc1bacf820eadd97a1">audiod_tx_done_cb</a>(uint8_t rhport, <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>* audio, uint16_t * n_bytes_copied)</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;{</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  uint8_t idxDriver, idxItf;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  uint8_t <span class="keyword">const</span> *dummy2;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="comment">// If a callback is used determine current alternate setting of</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#gae1b3c4b0537996ce0510a2e6685a1510">tud_audio_tx_done_pre_load_cb</a> || <a class="code" href="group___a_u_d_i_o___serial___device.html#gafcddd5b6cf7937c3a028fd49f0abe64c">tud_audio_tx_done_post_load_cb</a>)</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="comment">// Find index of audio streaming interface and index of interface</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    TU_VERIFY(<a class="code" href="audio__device_8c.html#addcbf82fb684c80d4f2c22d0833fce44">audiod_get_AS_interface_index</a>(audio-&gt;<a class="code" href="structaudiod__interface__t.html#a4822da41b42dcf15bf73364bea0565f2">ep_in_as_intf_num</a>, &amp;idxDriver, &amp;idxItf, &amp;dummy2));</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160; </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="comment">// Call a weak callback here - a possibility for user to get informed former TX was completed and data gets now loaded into EP in buffer (in case FIFOs are used) or</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="comment">// if no FIFOs are used the user may use this call back to load its data into the EP in buffer by use of tud_audio_n_write_ep_in_buffer().</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#gae1b3c4b0537996ce0510a2e6685a1510">tud_audio_tx_done_pre_load_cb</a>) TU_VERIFY(<a class="code" href="group___a_u_d_i_o___serial___device.html#gae1b3c4b0537996ce0510a2e6685a1510">tud_audio_tx_done_pre_load_cb</a>(rhport, idxDriver, audio-&gt;<a class="code" href="structaudiod__interface__t.html#a6d80c8df994755d6bda4b74c5feb4c55">ep_in</a>, audio-&gt;<a class="code" href="structaudiod__interface__t.html#a6f525368d2d6d9cf8416edc2a067c3b8">altSetting</a>[idxItf]));</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_TX_FIFO_SIZE</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="keywordflow">switch</span> (CFG_TUD_AUDIO_FORMAT_TYPE_TX)</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">case</span> AUDIO_FORMAT_TYPE_UNDEFINED:</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="comment">// INDIVIDUAL ENCODING PROCEDURE REQUIRED HERE!</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      TU_LOG2(<span class="stringliteral">&quot;  Desired CFG_TUD_AUDIO_FORMAT encoding not implemented!\r\n&quot;</span>);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      TU_BREAKPOINT();</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">case</span> AUDIO_FORMAT_TYPE_I:</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      <span class="keywordflow">switch</span> (CFG_TUD_AUDIO_FORMAT_TYPE_I_TX)</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="keywordflow">case</span> AUDIO_DATA_FORMAT_TYPE_I_PCM:</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;          TU_VERIFY(<a class="code" href="audio__device_8c.html#a0422a57de30423fd529fd73cf3530a2b">audiod_tx_done_type_I_pcm_ff_cb</a>(rhport, audio));</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;          <span class="comment">// YOUR ENCODING IS REQUIRED HERE!</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;          TU_LOG2(<span class="stringliteral">&quot;  Desired CFG_TUD_AUDIO_FORMAT_TYPE_I_TX encoding not implemented!\r\n&quot;</span>);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;          TU_BREAKPOINT();</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;          <span class="comment">// Desired CFG_TUD_AUDIO_FORMAT_TYPE_TX not implemented!</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;          TU_LOG2(<span class="stringliteral">&quot;  Desired CFG_TUD_AUDIO_FORMAT_TYPE_TX not implemented!\r\n&quot;</span>);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;          TU_BREAKPOINT();</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="comment">// THIS IS A CRITICAL SECTION - audio-&gt;epin_buf_cnt MUST NOT BE MODIFIED FROM HERE - happens if tud_audio_n_write_ep_in_buffer() is executed in between!</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="comment">// THIS IS NOT SOLVED SO FAR!</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160; </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="comment">// FOR SINGLE THREADED OPERATION:</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="comment">// THIS FUNCTION IS NOT EXECUTED WITHIN AN INTERRUPT SO IT DOES NOT INTERRUPT tud_audio_n_write_ep_in_buffer()! AS LONG AS tud_audio_n_write_ep_in_buffer() IS NOT EXECUTED WITHIN AN INTERRUPT ALL IS FINE!</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="comment">// Schedule transmit</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  TU_VERIFY(<a class="code" href="usbd_8c.html#a381b55ad6eadb2bad7f95e2286dc50c9">usbd_edpt_xfer</a>(rhport, audio-&gt;<a class="code" href="structaudiod__interface__t.html#a6d80c8df994755d6bda4b74c5feb4c55">ep_in</a>, audio-&gt;<a class="code" href="structaudiod__interface__t.html#a1e7250e29ffe799e7e614e7334299471">epin_buf</a>, audio-&gt;<a class="code" href="structaudiod__interface__t.html#a2d66b7cda27cdb10981693940bff5887">epin_buf_cnt</a>));</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="comment">// Inform how many bytes were copied</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  *n_bytes_copied = audio-&gt;<a class="code" href="structaudiod__interface__t.html#a2d66b7cda27cdb10981693940bff5887">epin_buf_cnt</a>;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160; </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <span class="comment">// Declare EP in buffer empty</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  audio-&gt;<a class="code" href="structaudiod__interface__t.html#a2d66b7cda27cdb10981693940bff5887">epin_buf_cnt</a> = 0;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="comment">// TO HERE</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="comment">// Call a weak callback here - a possibility for user to get informed former TX was completed and how many bytes were loaded for the next frame</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#gafcddd5b6cf7937c3a028fd49f0abe64c">tud_audio_tx_done_post_load_cb</a>) TU_VERIFY(<a class="code" href="group___a_u_d_i_o___serial___device.html#gafcddd5b6cf7937c3a028fd49f0abe64c">tud_audio_tx_done_post_load_cb</a>(rhport, *n_bytes_copied, idxDriver, audio-&gt;<a class="code" href="structaudiod__interface__t.html#a6d80c8df994755d6bda4b74c5feb4c55">ep_in</a>, audio-&gt;<a class="code" href="structaudiod__interface__t.html#a6f525368d2d6d9cf8416edc2a067c3b8">altSetting</a>[idxItf]));</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;}</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160; </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="preprocessor">#endif </span><span class="comment">//CFG_TUD_AUDIO_EPSIZE_IN</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160; </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_TX_FIFO_SIZE</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_TX_FIFO_COUNT &gt; 1 || (CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_TX != CFG_TUD_AUDIO_TX_ITEMSIZE)</span></div>
<div class="line"><a name="l00554"></a><span class="lineno"><a class="line" href="audio__device_8c.html#a0422a57de30423fd529fd73cf3530a2b">  554</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#a0422a57de30423fd529fd73cf3530a2b">audiod_tx_done_type_I_pcm_ff_cb</a>(uint8_t rhport, <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>* audio)</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;{</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="comment">// We encode directly into IN EP&#39;s buffer - abort if previous transfer not complete</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  TU_VERIFY(!<a class="code" href="usbd_8c.html#a66f04dcaad638cd71eb379c84cf5d4b8">usbd_edpt_busy</a>(rhport, audio-&gt;<a class="code" href="structaudiod__interface__t.html#a6d80c8df994755d6bda4b74c5feb4c55">ep_in</a>));</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="comment">// Determine amount of samples</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  uint16_t <span class="keyword">const</span> nEndpointSampleCapacity = CFG_TUD_AUDIO_EPSIZE_IN / CFG_TUD_AUDIO_N_CHANNELS_TX / CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_TX;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  uint16_t nSamplesPerChannelToSend = <a class="code" href="group__group__fifo.html#ga0653c4e3af5b0b2766ff72264f5836b7">tu_fifo_count</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#abae241b79effc5e4a34753cb5873fc09">tx_ff</a>[0]) / CFG_TUD_AUDIO_TX_ITEMSIZE;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  uint16_t nBytesToSend;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  uint8_t cntChannel;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160; </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="keywordflow">for</span> (cntChannel = 1; cntChannel &lt; CFG_TUD_AUDIO_N_CHANNELS_TX; cntChannel++)</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    uint16_t <span class="keyword">const</span> count = <a class="code" href="group__group__fifo.html#ga0653c4e3af5b0b2766ff72264f5836b7">tu_fifo_count</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#abae241b79effc5e4a34753cb5873fc09">tx_ff</a>[cntChannel]);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordflow">if</span> (count / CFG_TUD_AUDIO_TX_ITEMSIZE &lt; nSamplesPerChannelToSend)</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    {</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      nSamplesPerChannelToSend = count * CFG_TUD_AUDIO_TX_ITEMSIZE;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="comment">// Check if there is enough</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keywordflow">if</span> (nSamplesPerChannelToSend == 0)</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  {</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    audio-&gt;<a class="code" href="structaudiod__interface__t.html#a2d66b7cda27cdb10981693940bff5887">epin_buf_cnt</a> = 0;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="comment">// Limit to maximum sample number - THIS IS A POSSIBLE ERROR SOURCE IF TOO MANY SAMPLE WOULD NEED TO BE SENT BUT CAN NOT!</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  nSamplesPerChannelToSend = tu_min16(nSamplesPerChannelToSend, nEndpointSampleCapacity);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  nBytesToSend = nSamplesPerChannelToSend * CFG_TUD_AUDIO_N_CHANNELS_TX * CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_TX;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="comment">// Encode</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  uint16_t cntSample;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  uint8_t * pBuff = audio-&gt;<a class="code" href="structaudiod__interface__t.html#a1e7250e29ffe799e7e614e7334299471">epin_buf</a>;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_TX == 1</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  uint8_t sample;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="preprocessor">#elif CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_TX == 2</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  uint16_t sample;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  uint32_t sample;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160; </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="comment">// TODO: Big endianess handling</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="keywordflow">for</span> (cntSample = 0; cntSample &lt; nSamplesPerChannelToSend; cntSample++)</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  {</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">for</span> (cntChannel = 0; cntChannel &lt; CFG_TUD_AUDIO_N_CHANNELS_TX; cntChannel++)</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <span class="comment">// Get sample from buffer</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      <a class="code" href="group__group__fifo.html#gac2550100e64724b1c1e29fe59735499d">tu_fifo_read_n</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#abae241b79effc5e4a34753cb5873fc09">tx_ff</a>[cntChannel], &amp;sample, CFG_TUD_AUDIO_TX_ITEMSIZE);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160; </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="comment">// Put it into EP&#39;s buffer - Let alignment problems be handled by memcpy</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      memcpy(pBuff, &amp;sample, CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_TX);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <span class="comment">// Advance pointer</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      pBuff += CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_TX;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  audio-&gt;<a class="code" href="structaudiod__interface__t.html#a2d66b7cda27cdb10981693940bff5887">epin_buf_cnt</a> = nBytesToSend;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;}</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160; </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#a0422a57de30423fd529fd73cf3530a2b">audiod_tx_done_type_I_pcm_ff_cb</a>(uint8_t rhport, <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>* audio)</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;{</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="comment">// We encode directly into IN EP&#39;s buffer - abort if previous transfer not complete</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  TU_VERIFY(!<a class="code" href="usbd_8c.html#a66f04dcaad638cd71eb379c84cf5d4b8">usbd_edpt_busy</a>(rhport, audio-&gt;<a class="code" href="structaudiod__interface__t.html#a6d80c8df994755d6bda4b74c5feb4c55">ep_in</a>));</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="comment">// Determine amount of samples</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  uint16_t nByteCount = <a class="code" href="group__group__fifo.html#ga0653c4e3af5b0b2766ff72264f5836b7">tu_fifo_count</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#abae241b79effc5e4a34753cb5873fc09">tx_ff</a>[0]);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  nByteCount = tu_min16(nByteCount, CFG_TUD_AUDIO_EPSIZE_IN);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="comment">// Check if there is enough</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="keywordflow">if</span> (nByteCount == 0)</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  nByteCount = <a class="code" href="group__group__fifo.html#gac2550100e64724b1c1e29fe59735499d">tu_fifo_read_n</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#abae241b79effc5e4a34753cb5873fc09">tx_ff</a>[0], audio-&gt;<a class="code" href="structaudiod__interface__t.html#a1e7250e29ffe799e7e614e7334299471">epin_buf</a>, nByteCount);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  audio-&gt;<a class="code" href="structaudiod__interface__t.html#a2d66b7cda27cdb10981693940bff5887">epin_buf_cnt</a> = nByteCount;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;}</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="preprocessor">#endif </span><span class="comment">// CFG_TUD_AUDIO_TX_FIFO_COUNT &gt; 1 || (CFG_TUD_AUDIO_N_BYTES_PER_SAMPLE_TX != CFG_TUD_AUDIO_TX_ITEMSIZE)</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160; </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="preprocessor">#endif </span><span class="comment">//CFG_TUD_AUDIO_TX_FIFO_SIZE</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">// This function is called once a transmit of an feedback packet was successfully completed. Here, we get the next feedback value to be sent</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160; </div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_OUT &amp;&amp; CFG_TUD_AUDIO_ENABLE_FEEDBACK_EP</span></div>
<div class="line"><a name="l00646"></a><span class="lineno"><a class="line" href="audio__device_8c.html#a9cc6d9a3ec813e737a817bbaacc1290d">  646</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#a9cc6d9a3ec813e737a817bbaacc1290d">audio_fb_send</a>(uint8_t rhport, <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a> *audio)</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;{</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  uint8_t fb[4];</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  uint16_t len;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keywordflow">if</span> (audio-&gt;<a class="code" href="structaudiod__interface__t.html#aca1971fc878ae5d0725d81a67ce83e29">fb_val</a> == 0)</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  {</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    len = 0;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  {</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    len = 4;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="comment">// Here we need to return the feedback value</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">if</span> (rhport == 0)</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    {</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="comment">// For FS format is 10.14</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      fb[0] = (audio-&gt;<a class="code" href="structaudiod__interface__t.html#aca1971fc878ae5d0725d81a67ce83e29">fb_val</a> &gt;&gt; 2) &amp; 0xFF;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      fb[1] = (audio-&gt;<a class="code" href="structaudiod__interface__t.html#aca1971fc878ae5d0725d81a67ce83e29">fb_val</a> &gt;&gt; 10) &amp; 0xFF;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      fb[2] = (audio-&gt;<a class="code" href="structaudiod__interface__t.html#aca1971fc878ae5d0725d81a67ce83e29">fb_val</a> &gt;&gt; 18) &amp; 0xFF;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="comment">// 4th byte is needed to work correctly with MS Windows</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      fb[3] = 0;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    {</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="comment">// For HS format is 16.16</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      fb[0] = (audio-&gt;<a class="code" href="structaudiod__interface__t.html#aca1971fc878ae5d0725d81a67ce83e29">fb_val</a> &gt;&gt; 0) &amp; 0xFF;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      fb[1] = (audio-&gt;<a class="code" href="structaudiod__interface__t.html#aca1971fc878ae5d0725d81a67ce83e29">fb_val</a> &gt;&gt; 8) &amp; 0xFF;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      fb[2] = (audio-&gt;<a class="code" href="structaudiod__interface__t.html#aca1971fc878ae5d0725d81a67ce83e29">fb_val</a> &gt;&gt; 16) &amp; 0xFF;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      fb[3] = (audio-&gt;<a class="code" href="structaudiod__interface__t.html#aca1971fc878ae5d0725d81a67ce83e29">fb_val</a> &gt;&gt; 24) &amp; 0xFF;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    }</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="usbd_8c.html#a381b55ad6eadb2bad7f95e2286dc50c9">usbd_edpt_xfer</a>(rhport, audio-&gt;<a class="code" href="structaudiod__interface__t.html#a79b64e83989a2821c496dfad732563ef">ep_fb</a>, fb, len);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  }</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160; </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;}</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">//static uint16_t audio_fb_done_cb(uint8_t rhport, audiod_interface_t* audio)</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">//{</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">//  (void) rhport;</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">//  (void) audio;</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">//  if (tud_audio_fb_done_cb) TU_VERIFY(tud_audio_fb_done_cb(rhport));</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">//  return 0;</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">//}</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="comment">// This function is called once a transmit of an interrupt control packet was successfully completed. Here, we get the remaining bytes to send</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_INT_CTR_EPSIZE_IN</span></div>
<div class="line"><a name="l00696"></a><span class="lineno"><a class="line" href="audio__device_8c.html#ae066b3daf0858170fa840068e30ce6b3">  696</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#ae066b3daf0858170fa840068e30ce6b3">audio_int_ctr_done_cb</a>(uint8_t rhport, <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>* audio, uint16_t * n_bytes_copied)</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;{</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="comment">// We write directly into the EP&#39;s buffer - abort if previous transfer not complete</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  TU_VERIFY(!<a class="code" href="usbd_8c.html#a66f04dcaad638cd71eb379c84cf5d4b8">usbd_edpt_busy</a>(rhport, audio-&gt;<a class="code" href="structaudiod__interface__t.html#aabf94bbb03fb61a7f821cb3b19eee159">ep_int_ctr</a>));</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160; </div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <span class="comment">// TODO: Big endianess handling</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  uint16_t cnt = <a class="code" href="group__group__fifo.html#gac2550100e64724b1c1e29fe59735499d">tu_fifo_read_n</a>(audio-&gt;<a class="code" href="structaudiod__interface__t.html#aa718168a12b7112d4d9a4a6847d580e0">int_ctr_ff</a>, audio-&gt;<a class="code" href="structaudiod__interface__t.html#a7847aaafa32aa3ef13f6b58fa747467b">ep_int_ctr_buf</a>, CFG_TUD_AUDIO_INT_CTR_EPSIZE_IN);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keywordflow">if</span> (cnt &gt; 0)</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="comment">// Schedule transmit</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    TU_VERIFY(<a class="code" href="usbd_8c.html#a381b55ad6eadb2bad7f95e2286dc50c9">usbd_edpt_xfer</a>(rhport, audio-&gt;<a class="code" href="structaudiod__interface__t.html#aabf94bbb03fb61a7f821cb3b19eee159">ep_int_ctr</a>, audio-&gt;<a class="code" href="structaudiod__interface__t.html#a7847aaafa32aa3ef13f6b58fa747467b">ep_int_ctr_buf</a>, cnt));</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  }</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  *n_bytes_copied = cnt;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160; </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#ga076a60dbc1b05ef987448adb78230550">tud_audio_int_ctr_done_cb</a>) TU_VERIFY(<a class="code" href="group___a_u_d_i_o___serial___device.html#ga076a60dbc1b05ef987448adb78230550">tud_audio_int_ctr_done_cb</a>(rhport, n_bytes_copied));</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;}</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160; </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">//--------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">// USBD Driver API</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">//--------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00721"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#ga4fa6dd742c1d1fd387767079876c8f19">  721</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#ga4fa6dd742c1d1fd387767079876c8f19">audiod_init</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;{</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  tu_memclr(<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>, <span class="keyword">sizeof</span>(<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>));</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <span class="keywordflow">for</span>(uint8_t i=0; i&lt;CFG_TUD_AUDIO; i++)</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  {</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>* audio = &amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i];</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="comment">// Initialize TX FIFOs if required</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_IN &amp;&amp; CFG_TUD_AUDIO_TX_FIFO_SIZE</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordflow">for</span> (uint8_t cnt = 0; cnt &lt; CFG_TUD_AUDIO_TX_FIFO_COUNT; cnt++)</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    {</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <a class="code" href="group__group__fifo.html#ga4dfb40d48350bdff5c7f47321703d886">tu_fifo_config</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#abae241b79effc5e4a34753cb5873fc09">tx_ff</a>[cnt], &amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#ab86fe42db2fa6ef7d85918ecd302eaec">tx_ff_buf</a>[cnt], CFG_TUD_AUDIO_TX_FIFO_SIZE, 1, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="preprocessor">#if CFG_FIFO_MUTEX</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <a class="code" href="group__group__fifo.html#ga10af7f477229b0dbff381107d6c96e59">tu_fifo_config_mutex</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#abae241b79effc5e4a34753cb5873fc09">tx_ff</a>[cnt], <a class="code" href="osal_8h.html#a6f2721e8b6bb1100d20d5e65fb9506a2">osal_mutex_create</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#aefbedc5757f6a36a611d84c54a787955">tx_ff_mutex</a>[cnt]));</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    }</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_OUT &amp;&amp; CFG_TUD_AUDIO_RX_FIFO_SIZE</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keywordflow">for</span> (uint8_t cnt = 0; cnt &lt; CFG_TUD_AUDIO_RX_FIFO_COUNT; cnt++)</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    {</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <a class="code" href="group__group__fifo.html#ga4dfb40d48350bdff5c7f47321703d886">tu_fifo_config</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#ab0d6da4e705a63123e4d1170157231ff">rx_ff</a>[cnt], &amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#a4803234e5365a68c80be0e704823bef1">rx_ff_buf</a>[cnt], CFG_TUD_AUDIO_RX_FIFO_SIZE, 1, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="preprocessor">#if CFG_FIFO_MUTEX</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      <a class="code" href="group__group__fifo.html#ga10af7f477229b0dbff381107d6c96e59">tu_fifo_config_mutex</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#ab0d6da4e705a63123e4d1170157231ff">rx_ff</a>[cnt], <a class="code" href="osal_8h.html#a6f2721e8b6bb1100d20d5e65fb9506a2">osal_mutex_create</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#ac88cb4873bc4b6b55341a7356d8c74a1">rx_ff_mutex</a>[cnt]));</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    }</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_INT_CTR_EPSIZE_IN &gt; 0</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <a class="code" href="group__group__fifo.html#ga4dfb40d48350bdff5c7f47321703d886">tu_fifo_config</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#aa718168a12b7112d4d9a4a6847d580e0">int_ctr_ff</a>, &amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#a7a101747bf0a4cc519fc472c4fa683ef">int_ctr_ff_buf</a>, CFG_TUD_AUDIO_INT_CTR_BUFSIZE, 1, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="preprocessor">#if CFG_FIFO_MUTEX</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <a class="code" href="group__group__fifo.html#ga10af7f477229b0dbff381107d6c96e59">tu_fifo_config_mutex</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#aa718168a12b7112d4d9a4a6847d580e0">int_ctr_ff</a>, <a class="code" href="osal_8h.html#a6f2721e8b6bb1100d20d5e65fb9506a2">osal_mutex_create</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#a4d4468ca5402d897306f260a9d8fda16">int_ctr_ff_mutex</a>));</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  }</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;}</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#ga94447dfe41f27fdde46871973a236886">  759</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#ga94447dfe41f27fdde46871973a236886">audiod_reset</a>(uint8_t rhport)</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;{</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  (void) rhport;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <span class="keywordflow">for</span>(uint8_t i=0; i&lt;CFG_TUD_AUDIO; i++)</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  {</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a>* audio = &amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i];</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    tu_memclr(audio, ITF_MEM_RESET_SIZE);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_IN &amp;&amp; CFG_TUD_AUDIO_TX_FIFO_SIZE</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordflow">for</span> (uint8_t cnt = 0; cnt &lt; CFG_TUD_AUDIO_TX_FIFO_COUNT; cnt++)</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    {</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      <a class="code" href="group__group__fifo.html#gaf629a02b7f0b2dc380bfdc1d8ca05723">tu_fifo_clear</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#abae241b79effc5e4a34753cb5873fc09">tx_ff</a>[cnt]);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    }</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160; </div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_OUT &amp;&amp; CFG_TUD_AUDIO_RX_FIFO_SIZE</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordflow">for</span> (uint8_t cnt = 0; cnt &lt; CFG_TUD_AUDIO_RX_FIFO_COUNT; cnt++)</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    {</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      <a class="code" href="group__group__fifo.html#gaf629a02b7f0b2dc380bfdc1d8ca05723">tu_fifo_clear</a>(&amp;audio-&gt;<a class="code" href="structaudiod__interface__t.html#ab0d6da4e705a63123e4d1170157231ff">rx_ff</a>[cnt]);</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    }</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  }</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;}</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160; </div>
<div class="line"><a name="l00784"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#ga05dc4cf6537e042cceacbc9fddcf5bd4">  784</a></span>&#160;uint16_t <a class="code" href="group___a_u_d_i_o___serial___device.html#ga05dc4cf6537e042cceacbc9fddcf5bd4">audiod_open</a>(uint8_t rhport, <a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_desc_interface_t</a> <span class="keyword">const</span> * itf_desc, uint16_t max_len)</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;{</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  (void) max_len;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160; </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  TU_VERIFY ( <a class="code" href="group___u_s_b_def___type.html#gga163997b8e3d823786be70e2f192e87f6a1c0286b14f0983947cb58639aa254bd8">TUSB_CLASS_AUDIO</a>  == itf_desc-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#aadd38c49cc1af3f056eba046eb9fed9d">bInterfaceClass</a> &amp;&amp;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;              <a class="code" href="group___class_driver___audio.html#gga959777adfa0a40af13b50e0aec895428a88af25d50de4915c08ed6bf0b5ffe590">AUDIO_SUBCLASS_CONTROL</a>    == itf_desc-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#ace0fdf8430d37ab5190b296d619432f2">bInterfaceSubClass</a>);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; </div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="comment">// Verify version is correct - this check can be omitted</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  TU_VERIFY(itf_desc-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#ae547f66a4366cf0b4800c5f709b1568a">bInterfaceProtocol</a> == <a class="code" href="group___class_driver___audio.html#ggac2b9f68f7beb6aa574692bc9223ad0bcae702c02fe9a3a601da33eca436d877e9">AUDIO_INT_PROTOCOL_CODE_V2</a>);</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160; </div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <span class="comment">// Verify interrupt control EP is enabled if demanded by descriptor - this should be best some static check however - this check can be omitted</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="keywordflow">if</span> (itf_desc-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#ae33ee9029d2e2ca9e33a4ac8e8b0610b">bNumEndpoints</a> == 1) <span class="comment">// 0 or 1 EPs are allowed</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  {</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    TU_VERIFY(CFG_TUD_AUDIO_INT_CTR_EPSIZE_IN &gt; 0);</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  }</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160; </div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="comment">// Alternate setting MUST be zero - this check can be omitted</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  TU_VERIFY(itf_desc-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#af2550553f18c20966282846f2fa548bc">bAlternateSetting</a> == 0);</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160; </div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="comment">// Find available audio driver interface</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  uint8_t i;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; CFG_TUD_AUDIO; i++)</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  {</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].p_desc)</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    {</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].<a class="code" href="structaudiod__interface__t.html#a6447ba0d0c6f3c0387556a9d0b35f22e">p_desc</a> = (uint8_t <span class="keyword">const</span> *)itf_desc;    <span class="comment">// Save pointer to AC descriptor which is by specification always the first one</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].<a class="code" href="structaudiod__interface__t.html#a26eadf826c08e25eced602925238224b">rhport</a> = rhport;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    }</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  }</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160; </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <span class="comment">// Verify we found a free one</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  TU_ASSERT( i &lt; CFG_TUD_AUDIO );</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160; </div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="comment">// This is all we need so far - the EPs are setup by a later set_interface request (as per UAC2 specification)</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="comment">// TODO: Find a way to find end of current audio function and avoid necessity of tud_audio_desc_lengths - since now max_length is available we could do this surely somehow</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  uint16_t drv_len = <a class="code" href="audio__device_8c.html#ac36d4c519e458a99d79a121eac59a5df">tud_audio_desc_lengths</a>[i] - TUD_AUDIO_DESC_IAD_LEN;    <span class="comment">// - TUD_AUDIO_DESC_IAD_LEN since tinyUSB already handles the IAD descriptor</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160; </div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  <span class="keywordflow">return</span> drv_len;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;}</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160; </div>
<div class="line"><a name="l00825"></a><span class="lineno"><a class="line" href="audio__device_8c.html#a95893a2600798eec6df171e4cd0b6e70">  825</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#a95893a2600798eec6df171e4cd0b6e70">audiod_get_interface</a>(uint8_t rhport, <a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_control_request_t</a> <span class="keyword">const</span> * p_request)</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;{</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_N_AS_INT &gt; 0</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  uint8_t <span class="keyword">const</span> itf = tu_u16_low(p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a9d5ce5ef1272f91aaf9fc18e5d97b8f3">wIndex</a>);</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="comment">// Find index of audio streaming interface</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  uint8_t idxDriver, idxItf;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  uint8_t <span class="keyword">const</span> *dummy;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160; </div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  TU_VERIFY(<a class="code" href="audio__device_8c.html#addcbf82fb684c80d4f2c22d0833fce44">audiod_get_AS_interface_index</a>(itf, &amp;idxDriver, &amp;idxItf, &amp;dummy));</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  TU_VERIFY(<a class="code" href="usbd_8h.html#a4e06b404ecb86635fe41f44b8bcb5401">tud_control_xfer</a>(rhport, p_request, &amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].altSetting[idxItf], 1));</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; </div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  TU_LOG2(<span class="stringliteral">&quot;  Get itf: %u - current alt: %u\r\n&quot;</span>, itf, <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].altSetting[idxItf]);</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160; </div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  (void) rhport;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  (void) p_request;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;}</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno"><a class="line" href="audio__device_8c.html#a7abe0efec0cf613405fa2995d15b2c8e">  848</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#a7abe0efec0cf613405fa2995d15b2c8e">audiod_set_interface</a>(uint8_t rhport, <a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_control_request_t</a> <span class="keyword">const</span> * p_request)</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;{</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  (void) rhport;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="comment">// Here we need to do the following:</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160; </div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="comment">// 1. Find the audio driver assigned to the given interface to be set</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <span class="comment">// Since one audio driver interface has to be able to cover an unknown number of interfaces (AC, AS + its alternate settings), the best memory efficient way to solve this is to always search through the descriptors.</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="comment">// The audio driver is mapped to an audio function by a reference pointer to the corresponding AC interface of this audio function which serves as a starting point for searching</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160; </div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="comment">// 2. Close EPs which are currently open</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="comment">// To do so it is not necessary to know the current active alternate interface since we already save the current EP addresses - we simply close them</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160; </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="comment">// 3. Open new EP</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160; </div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  uint8_t <span class="keyword">const</span> itf = tu_u16_low(p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a9d5ce5ef1272f91aaf9fc18e5d97b8f3">wIndex</a>);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  uint8_t <span class="keyword">const</span> alt = tu_u16_low(p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a5464b2036f01c887759f3ee05fbea7e5">wValue</a>);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160; </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  TU_LOG2(<span class="stringliteral">&quot;  Set itf: %u - alt: %u\r\n&quot;</span>, itf, alt);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160; </div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="comment">// Find index of audio streaming interface and index of interface</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  uint8_t idxDriver, idxItf;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  uint8_t <span class="keyword">const</span> *p_desc;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  TU_VERIFY(<a class="code" href="audio__device_8c.html#addcbf82fb684c80d4f2c22d0833fce44">audiod_get_AS_interface_index</a>(itf, &amp;idxDriver, &amp;idxItf, &amp;p_desc));</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160; </div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="comment">// Look if there is an EP to be closed - for this driver, there are only 3 possible EPs which may be closed (only AS related EPs can be closed, AC EP (if present) is always open)</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_IN &gt; 0</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].ep_in_as_intf_num == itf)</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  {</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].<a class="code" href="structaudiod__interface__t.html#a4822da41b42dcf15bf73364bea0565f2">ep_in_as_intf_num</a> = 0;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <a class="code" href="usbd_8c.html#a2f04a6c0936ebf2d3015103dbd83153d">usbd_edpt_close</a>(rhport, <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].ep_in);</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="comment">// Invoke callback - can be used to stop data sampling</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#ga6939b9213de9c240c9a9f909fdcb71cb">tud_audio_set_itf_close_EP_cb</a>) TU_VERIFY(<a class="code" href="group___a_u_d_i_o___serial___device.html#ga6939b9213de9c240c9a9f909fdcb71cb">tud_audio_set_itf_close_EP_cb</a>(rhport, p_request));</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160; </div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].<a class="code" href="structaudiod__interface__t.html#a6d80c8df994755d6bda4b74c5feb4c55">ep_in</a> = 0;                           <span class="comment">// Necessary?</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160; </div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_OUT</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].ep_out_as_intf_num == itf)</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  {</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].<a class="code" href="structaudiod__interface__t.html#a0b6985b3138bea86dafe037071eff704">ep_out_as_intf_num</a> = 0;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <a class="code" href="usbd_8c.html#a2f04a6c0936ebf2d3015103dbd83153d">usbd_edpt_close</a>(rhport, <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].ep_out);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].<a class="code" href="structaudiod__interface__t.html#ad6374eb5e7c83a8dec7a16bf7d61f199">ep_out</a> = 0;                          <span class="comment">// Necessary?</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="comment">// Close corresponding feedback EP</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_ENABLE_FEEDBACK_EP</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <a class="code" href="usbd_8c.html#a2f04a6c0936ebf2d3015103dbd83153d">usbd_edpt_close</a>(rhport, <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].ep_fb);</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].<a class="code" href="structaudiod__interface__t.html#a79b64e83989a2821c496dfad732563ef">ep_fb</a> = 0;                           <span class="comment">// Necessary?</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  }</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160; </div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="comment">// Save current alternative interface setting</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].<a class="code" href="structaudiod__interface__t.html#a6f525368d2d6d9cf8416edc2a067c3b8">altSetting</a>[idxItf] = alt;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160; </div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <span class="comment">// Open new EP if necessary - EPs are only to be closed or opened for AS interfaces - Look for AS interface with correct alternate interface</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  <span class="comment">// Get pointer at end</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  uint8_t <span class="keyword">const</span> *p_desc_end = <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].<a class="code" href="structaudiod__interface__t.html#a6447ba0d0c6f3c0387556a9d0b35f22e">p_desc</a> + <a class="code" href="audio__device_8c.html#ac36d4c519e458a99d79a121eac59a5df">tud_audio_desc_lengths</a>[idxDriver] - TUD_AUDIO_DESC_IAD_LEN;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160; </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="comment">// p_desc starts at required interface with alternate setting zero</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="keywordflow">while</span> (p_desc &lt; p_desc_end)</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  {</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <span class="comment">// Find correct interface</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b_def___type.html#gaec3d617e38f349c026a4d2558d814513">tu_desc_type</a>(p_desc) == <a class="code" href="group___u_s_b_def___type.html#ggacb5e6c763fa4283e1be386759d1dfc13ae6894b69faf0ba905e3263cf93a999e4">TUSB_DESC_INTERFACE</a> &amp;&amp; ((<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_desc_interface_t</a> <span class="keyword">const</span> * )p_desc)-&gt;bInterfaceNumber == itf &amp;&amp; ((<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_desc_interface_t</a> <span class="keyword">const</span> * )p_desc)-&gt;bAlternateSetting == alt)</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    {</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <span class="comment">// From this point forward follow the EP descriptors associated to the current alternate setting interface - Open EPs if necessary</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      uint8_t foundEPs = 0, nEps = ((<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_desc_interface_t</a> <span class="keyword">const</span> * )p_desc)-&gt;bNumEndpoints;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      <span class="keywordflow">while</span> (foundEPs &lt; nEps &amp;&amp; p_desc &lt; p_desc_end)</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      {</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b_def___type.html#gaec3d617e38f349c026a4d2558d814513">tu_desc_type</a>(p_desc) == <a class="code" href="group___u_s_b_def___type.html#ggacb5e6c763fa4283e1be386759d1dfc13abab5f4629d2d2bf0fb2bd3189c1f02f3">TUSB_DESC_ENDPOINT</a>)</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        {</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;          TU_ASSERT(<a class="code" href="usbd_8c.html#a406b8e3f5527c4ca9b545e538b4181e9">usbd_edpt_open</a>(rhport, (<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_desc_endpoint_t</a> <span class="keyword">const</span> *)p_desc));</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160; </div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;          uint8_t ep_addr = ((<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_desc_endpoint_t</a> <span class="keyword">const</span> *) p_desc)-&gt;bEndpointAddress;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160; </div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;          <span class="comment">// We need to set EP non busy since this is not taken care of right now in ep_close() - THIS IS A WORKAROUND!</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;          <a class="code" href="usbd_8c.html#a2acfc7062ccd10892583c6c674e27757">usbd_edpt_clear_stall</a>(rhport, ep_addr);</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160; </div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_IN &gt; 0</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b_def___type.html#gaaa353f2da73c8d7c4dda783341e4c681">tu_edpt_dir</a>(ep_addr) == <a class="code" href="group___u_s_b_def___type.html#gga0c1b25b161b272f5f39e4ba49478289ca29e402c2558d1a97a08294c5d1837444">TUSB_DIR_IN</a> &amp;&amp; ((<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_desc_endpoint_t</a> <span class="keyword">const</span> *) p_desc)-&gt;bmAttributes.usage == 0x00)   <span class="comment">// Check if usage is data EP</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;          {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            <span class="comment">// Save address</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;            <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].<a class="code" href="structaudiod__interface__t.html#a6d80c8df994755d6bda4b74c5feb4c55">ep_in</a> = ep_addr;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].<a class="code" href="structaudiod__interface__t.html#a4822da41b42dcf15bf73364bea0565f2">ep_in_as_intf_num</a> = itf;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160; </div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;            <span class="comment">// Invoke callback - can be used to trigger data sampling if not already running</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#gadd76faa8f20f610f2b3d8742db0a4c9b">tud_audio_set_itf_cb</a>) TU_VERIFY(<a class="code" href="group___a_u_d_i_o___serial___device.html#gadd76faa8f20f610f2b3d8742db0a4c9b">tud_audio_set_itf_cb</a>(rhport, p_request));</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160; </div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            <span class="comment">// Schedule first transmit - in case no sample data is available a ZLP is loaded</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            uint16_t n_bytes_copied;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            TU_VERIFY(<a class="code" href="audio__device_8c.html#ab7f1ef914fa407dc1bacf820eadd97a1">audiod_tx_done_cb</a>(rhport, &amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver], &amp;n_bytes_copied));</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;          }</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160; </div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_OUT</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160; </div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b_def___type.html#gaaa353f2da73c8d7c4dda783341e4c681">tu_edpt_dir</a>(ep_addr) == <a class="code" href="group___u_s_b_def___type.html#gga0c1b25b161b272f5f39e4ba49478289ca96d25fd7f8e59bc00cdfd0cbeaa285ae">TUSB_DIR_OUT</a>)     <span class="comment">// Checking usage not necessary</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;          {</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            <span class="comment">// Save address</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].<a class="code" href="structaudiod__interface__t.html#ad6374eb5e7c83a8dec7a16bf7d61f199">ep_out</a> = ep_addr;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;            <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].<a class="code" href="structaudiod__interface__t.html#a0b6985b3138bea86dafe037071eff704">ep_out_as_intf_num</a> = itf;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160; </div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;            <span class="comment">// Invoke callback</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#gadd76faa8f20f610f2b3d8742db0a4c9b">tud_audio_set_itf_cb</a>) TU_VERIFY(<a class="code" href="group___a_u_d_i_o___serial___device.html#gadd76faa8f20f610f2b3d8742db0a4c9b">tud_audio_set_itf_cb</a>(rhport, p_request));</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; </div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            <span class="comment">// Prepare for incoming data</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            TU_ASSERT(<a class="code" href="usbd_8c.html#a381b55ad6eadb2bad7f95e2286dc50c9">usbd_edpt_xfer</a>(rhport, ep_addr, <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].epout_buf, CFG_TUD_AUDIO_EPSIZE_OUT), <span class="keyword">false</span>);</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;          }</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160; </div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_ENABLE_FEEDBACK_EP</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b_def___type.html#gaaa353f2da73c8d7c4dda783341e4c681">tu_edpt_dir</a>(ep_addr) == <a class="code" href="group___u_s_b_def___type.html#gga0c1b25b161b272f5f39e4ba49478289ca29e402c2558d1a97a08294c5d1837444">TUSB_DIR_IN</a> &amp;&amp; ((<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_desc_endpoint_t</a> <span class="keyword">const</span> *) p_desc)-&gt;bmAttributes.usage == 1)   <span class="comment">// Check if usage is explicit data feedback</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;          {</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;            <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].<a class="code" href="structaudiod__interface__t.html#a79b64e83989a2821c496dfad732563ef">ep_fb</a> = ep_addr;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160; </div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;            <span class="comment">// Invoke callback</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#gadd76faa8f20f610f2b3d8742db0a4c9b">tud_audio_set_itf_cb</a>) TU_VERIFY(<a class="code" href="group___a_u_d_i_o___serial___device.html#gadd76faa8f20f610f2b3d8742db0a4c9b">tud_audio_set_itf_cb</a>(rhport, p_request));</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;          }</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160; </div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;          foundEPs += 1;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        }</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        p_desc = <a class="code" href="group___u_s_b_def___type.html#gada5e96e4ab9e63c55e99f179085116f0">tu_desc_next</a>(p_desc);</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      }</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160; </div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      TU_VERIFY(foundEPs == nEps);</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      <span class="comment">// We are done - abort loop</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    }</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160; </div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="comment">// Moving forward</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    p_desc = <a class="code" href="group___u_s_b_def___type.html#gada5e96e4ab9e63c55e99f179085116f0">tu_desc_next</a>(p_desc);</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  }</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <a class="code" href="usbd_8h.html#ac6d1facfa117d185b95666a4ffe9810f">tud_control_status</a>(rhport, p_request);</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160; </div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;}</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160; </div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment">// Invoked when class request DATA stage is finished.</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment">// return false to stall control EP (e.g Host send non-sense DATA)</span></div>
<div class="line"><a name="l00992"></a><span class="lineno"><a class="line" href="audio__device_8c.html#a157776477c001bdd60ea446c36032713">  992</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#a157776477c001bdd60ea446c36032713">audiod_control_complete</a>(uint8_t rhport, <a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_control_request_t</a> <span class="keyword">const</span> * p_request)</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;{</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="comment">// Handle audio class specific set requests</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="keywordflow">if</span>(p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a840e65207ee03a571ad5d81fc0ec4fea">bmRequestType_bit</a>.type == <a class="code" href="group___u_s_b_def___type.html#ggabbeae90d995af4a347e21ab82eec9456abe22791174a5bf81fd550e340aae7d12">TUSB_REQ_TYPE_CLASS</a> &amp;&amp; p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a840e65207ee03a571ad5d81fc0ec4fea">bmRequestType_bit</a>.direction == <a class="code" href="group___u_s_b_def___type.html#gga0c1b25b161b272f5f39e4ba49478289ca96d25fd7f8e59bc00cdfd0cbeaa285ae">TUSB_DIR_OUT</a>)</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  {</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    uint8_t idxDriver;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160; </div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="keywordflow">switch</span> (p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a840e65207ee03a571ad5d81fc0ec4fea">bmRequestType_bit</a>.recipient)</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    {</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="group___u_s_b_def___type.html#gga7edb52971e0f0a9fa25fbc3a55469a98ab7cd0143d8423e9520467d425ca88a7e">TUSB_REQ_RCPT_INTERFACE</a>: ;       <span class="comment">// The semicolon is there to enable a declaration right after the label</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      uint8_t itf = TU_U16_LOW(p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a9d5ce5ef1272f91aaf9fc18e5d97b8f3">wIndex</a>);</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      uint8_t entityID = TU_U16_HIGH(p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a9d5ce5ef1272f91aaf9fc18e5d97b8f3">wIndex</a>);</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160; </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;      <span class="keywordflow">if</span> (entityID != 0)</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      {</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#ga31c7902c0165c66fd615aa504bc6092e">tud_audio_set_req_entity_cb</a>)</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        {</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;          <span class="comment">// Check if entity is present and get corresponding driver index</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;          TU_VERIFY(<a class="code" href="audio__device_8c.html#a965631c42a2f162557bea4ef61ce0ffa">audiod_verify_entity_exists</a>(itf, entityID, &amp;idxDriver));</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160; </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;          <span class="comment">// Invoke callback</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#ga31c7902c0165c66fd615aa504bc6092e">tud_audio_set_req_entity_cb</a>(rhport, p_request, <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].ctrl_buf);</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        }</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        {</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;          TU_LOG2(<span class="stringliteral">&quot;  No entity set request callback available!\r\n&quot;</span>);</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;     <span class="comment">// In case no callback function is present or request can not be conducted we stall it</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        }</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      }</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      {</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#ga50d7441a11431fda3a05f765ad1fd19c">tud_audio_set_req_itf_cb</a>)</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        {</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;          <span class="comment">// Find index of audio driver structure and verify interface really exists</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;          TU_VERIFY(<a class="code" href="audio__device_8c.html#afaa85901b20e8953a0c55b2ed688466c">audiod_verify_itf_exists</a>(itf, &amp;idxDriver));</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160; </div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;          <span class="comment">// Invoke callback</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#ga50d7441a11431fda3a05f765ad1fd19c">tud_audio_set_req_itf_cb</a>(rhport, p_request, <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].ctrl_buf);</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        }</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        {</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;          TU_LOG2(<span class="stringliteral">&quot;  No interface set request callback available!\r\n&quot;</span>);</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;     <span class="comment">// In case no callback function is present or request can not be conducted we stall it</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        }</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      }</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160; </div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160; </div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="group___u_s_b_def___type.html#gga7edb52971e0f0a9fa25fbc3a55469a98a4c7af1856e9ce49fb1f971b7f1cac9c5">TUSB_REQ_RCPT_ENDPOINT</a>: ;        <span class="comment">// The semicolon is there to enable a declaration right after the label</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160; </div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      uint8_t ep = TU_U16_LOW(p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a9d5ce5ef1272f91aaf9fc18e5d97b8f3">wIndex</a>);</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160; </div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#gab5b14ae7f83445319d4f8a9de0f0522a">tud_audio_set_req_ep_cb</a>)</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      {</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <span class="comment">// Check if entity is present and get corresponding driver index</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        TU_VERIFY(<a class="code" href="audio__device_8c.html#ad19beb67377f7e649bf5cbfc3bbdca9c">audiod_verify_ep_exists</a>(ep, &amp;idxDriver));</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160; </div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <span class="comment">// Invoke callback</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#gab5b14ae7f83445319d4f8a9de0f0522a">tud_audio_set_req_ep_cb</a>(rhport, p_request, <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].ctrl_buf);</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      }</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      {</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        TU_LOG2(<span class="stringliteral">&quot;  No EP set request callback available!\r\n&quot;</span>);</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;   <span class="comment">// In case no callback function is present or request can not be conducted we stall it</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      }</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160; </div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      <span class="comment">// Unknown/Unsupported recipient</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <span class="keywordflow">default</span>: TU_BREAKPOINT(); <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    }</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  }</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;}</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160; </div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment">// Handle class control request</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">// return false to stall control endpoint (e.g unsupported request)</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"><a class="line" href="audio__device_8c.html#a12f87dfd88ac7f27d136f1e8e18b47d7"> 1068</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#a12f87dfd88ac7f27d136f1e8e18b47d7">audiod_control_request</a>(uint8_t rhport, <a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_control_request_t</a> <span class="keyword">const</span> * p_request)</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;{</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  (void) rhport;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160; </div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  <span class="comment">// Handle standard requests - standard set requests usually have no data stage so we also handle set requests here</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  <span class="keywordflow">if</span> (p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a840e65207ee03a571ad5d81fc0ec4fea">bmRequestType_bit</a>.type == <a class="code" href="group___u_s_b_def___type.html#ggabbeae90d995af4a347e21ab82eec9456a1a5d5e44e508347c79fe9785308a8ce7">TUSB_REQ_TYPE_STANDARD</a>)</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  {</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordflow">switch</span> (p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#ad5dff13a5439a91a41750025ce2b8a73">bRequest</a>)</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    {</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="group___u_s_b_def___type.html#gga0ce8a24b63587d1b3ad6a73d53b9b5d7ac587684c81349834555732484f643930">TUSB_REQ_GET_INTERFACE</a>:</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="audio__device_8c.html#a95893a2600798eec6df171e4cd0b6e70">audiod_get_interface</a>(rhport, p_request);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160; </div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="group___u_s_b_def___type.html#gga0ce8a24b63587d1b3ad6a73d53b9b5d7ac058b37d5d6c5248a1cd8799fabc04e9">TUSB_REQ_SET_INTERFACE</a>:</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="audio__device_8c.html#a7abe0efec0cf613405fa2995d15b2c8e">audiod_set_interface</a>(rhport, p_request);</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160; </div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        <span class="comment">// Unknown/Unsupported request</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      <span class="keywordflow">default</span>: TU_BREAKPOINT(); <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    }</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  }</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160; </div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  <span class="comment">// Handle class requests</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <span class="keywordflow">if</span> (p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a840e65207ee03a571ad5d81fc0ec4fea">bmRequestType_bit</a>.type == <a class="code" href="group___u_s_b_def___type.html#ggabbeae90d995af4a347e21ab82eec9456abe22791174a5bf81fd550e340aae7d12">TUSB_REQ_TYPE_CLASS</a>)</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    uint8_t itf = TU_U16_LOW(p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a9d5ce5ef1272f91aaf9fc18e5d97b8f3">wIndex</a>);</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    uint8_t idxDriver;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160; </div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <span class="comment">// Conduct checks which depend on the recipient</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="keywordflow">switch</span> (p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a840e65207ee03a571ad5d81fc0ec4fea">bmRequestType_bit</a>.recipient)</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    {</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="group___u_s_b_def___type.html#gga7edb52971e0f0a9fa25fbc3a55469a98ab7cd0143d8423e9520467d425ca88a7e">TUSB_REQ_RCPT_INTERFACE</a>: ;       <span class="comment">// The semicolon is there to enable a declaration right after the label</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160; </div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      uint8_t entityID = TU_U16_HIGH(p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a9d5ce5ef1272f91aaf9fc18e5d97b8f3">wIndex</a>);</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160; </div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      <span class="comment">// Verify if entity is present</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      <span class="keywordflow">if</span> (entityID != 0)</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      {</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        <span class="comment">// Find index of audio driver structure and verify entity really exists</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        TU_VERIFY(<a class="code" href="audio__device_8c.html#a965631c42a2f162557bea4ef61ce0ffa">audiod_verify_entity_exists</a>(itf, entityID, &amp;idxDriver));</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160; </div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        <span class="comment">// In case we got a get request invoke callback - callback needs to answer as defined in UAC2 specification page 89 - 5. Requests</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <span class="keywordflow">if</span> (p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a840e65207ee03a571ad5d81fc0ec4fea">bmRequestType_bit</a>.direction == <a class="code" href="group___u_s_b_def___type.html#gga0c1b25b161b272f5f39e4ba49478289ca29e402c2558d1a97a08294c5d1837444">TUSB_DIR_IN</a>)</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        {</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#ga9dcd3251aee94442963d3db8cfbd2da7">tud_audio_get_req_entity_cb</a>)</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;          {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#ga9dcd3251aee94442963d3db8cfbd2da7">tud_audio_get_req_entity_cb</a>(rhport, p_request);</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;          }</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;          {</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;            TU_LOG2(<span class="stringliteral">&quot;  No entity get request callback available!\r\n&quot;</span>);</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;   <span class="comment">// Stall</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;          }</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        }</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      }</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      {</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        <span class="comment">// Find index of audio driver structure and verify interface really exists</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        TU_VERIFY(<a class="code" href="audio__device_8c.html#afaa85901b20e8953a0c55b2ed688466c">audiod_verify_itf_exists</a>(itf, &amp;idxDriver));</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160; </div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        <span class="comment">// In case we got a get request invoke callback - callback needs to answer as defined in UAC2 specification page 89 - 5. Requests</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        <span class="keywordflow">if</span> (p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a840e65207ee03a571ad5d81fc0ec4fea">bmRequestType_bit</a>.direction == <a class="code" href="group___u_s_b_def___type.html#gga0c1b25b161b272f5f39e4ba49478289ca29e402c2558d1a97a08294c5d1837444">TUSB_DIR_IN</a>)</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        {</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#gaf80121ee5456fc126cb4bd45b72e19c7">tud_audio_get_req_itf_cb</a>)</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;          {</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#gaf80121ee5456fc126cb4bd45b72e19c7">tud_audio_get_req_itf_cb</a>(rhport, p_request);</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;          }</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;          {</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;            TU_LOG2(<span class="stringliteral">&quot;  No interface get request callback available!\r\n&quot;</span>);</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;   <span class="comment">// Stall</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;          }</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        }</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      }</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160; </div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="group___u_s_b_def___type.html#gga7edb52971e0f0a9fa25fbc3a55469a98a4c7af1856e9ce49fb1f971b7f1cac9c5">TUSB_REQ_RCPT_ENDPOINT</a>: ;        <span class="comment">// The semicolon is there to enable a declaration right after the label</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160; </div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      uint8_t ep = TU_U16_LOW(p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a9d5ce5ef1272f91aaf9fc18e5d97b8f3">wIndex</a>);</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160; </div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      <span class="comment">// Find index of audio driver structure and verify EP really exists</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      TU_VERIFY(<a class="code" href="audio__device_8c.html#ad19beb67377f7e649bf5cbfc3bbdca9c">audiod_verify_ep_exists</a>(ep, &amp;idxDriver));</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160; </div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      <span class="comment">// In case we got a get request invoke callback - callback needs to answer as defined in UAC2 specification page 89 - 5. Requests</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      <span class="keywordflow">if</span> (p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a840e65207ee03a571ad5d81fc0ec4fea">bmRequestType_bit</a>.direction == <a class="code" href="group___u_s_b_def___type.html#gga0c1b25b161b272f5f39e4ba49478289ca29e402c2558d1a97a08294c5d1837444">TUSB_DIR_IN</a>)</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      {</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#ga46f6e442bac9e7c0eae60f2f4eaa3719">tud_audio_get_req_ep_cb</a>)</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        {</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#ga46f6e442bac9e7c0eae60f2f4eaa3719">tud_audio_get_req_ep_cb</a>(rhport, p_request);</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        }</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        {</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;          TU_LOG2(<span class="stringliteral">&quot;  No EP get request callback available!\r\n&quot;</span>);</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;     <span class="comment">// Stall</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        }</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      }</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160; </div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      <span class="comment">// Unknown/Unsupported recipient</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      <span class="keywordflow">default</span>: TU_LOG2(<span class="stringliteral">&quot;  Unsupported recipient: %d\r\n&quot;</span>, p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a840e65207ee03a571ad5d81fc0ec4fea">bmRequestType_bit</a>.recipient); TU_BREAKPOINT(); <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    }</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160; </div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="comment">// If we end here, the received request is a set request - we schedule a receive for the data stage and return true here. We handle the rest later in audiod_control_complete() once the data stage was finished</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    TU_VERIFY(<a class="code" href="usbd_8h.html#a4e06b404ecb86635fe41f44b8bcb5401">tud_control_xfer</a>(rhport, p_request, <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].ctrl_buf, CFG_TUD_AUDIO_CTRL_BUF_SIZE));</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  }</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160; </div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="comment">// There went something wrong - unsupported control request type</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  TU_BREAKPOINT();</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;}</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160; </div>
<div class="line"><a name="l01178"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#ga203ac09097d03c0e5669883120698746"> 1178</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#ga203ac09097d03c0e5669883120698746">audiod_control_xfer_cb</a>(uint8_t rhport, uint8_t stage, <a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_control_request_t</a> <span class="keyword">const</span> * request)</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;{</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <span class="keywordflow">if</span> ( stage == <a class="code" href="group___u_s_b_def___type.html#ggaaf105ae5beaca1dee30ae54530691fceaf17ae8688f98708446ce909eb0e83c7c">CONTROL_STAGE_SETUP</a> )</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  {</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="audio__device_8c.html#a12f87dfd88ac7f27d136f1e8e18b47d7">audiod_control_request</a>(rhport, <a class="code" href="_hid_command_interface_8h.html#a3f333b1c841dda37afbc4c28598a6fc5a10573b873d2fa5a365d558a45e328e47">request</a>);</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  }</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( stage == <a class="code" href="group___u_s_b_def___type.html#ggaaf105ae5beaca1dee30ae54530691fceae5d89e21948588e11d6564fdf0e66c0b">CONTROL_STAGE_DATA</a> )</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  {</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="audio__device_8c.html#a157776477c001bdd60ea446c36032713">audiod_control_complete</a>(rhport, <a class="code" href="_hid_command_interface_8h.html#a3f333b1c841dda37afbc4c28598a6fc5a10573b873d2fa5a365d558a45e328e47">request</a>);</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  }</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160; </div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;}</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160; </div>
<div class="line"><a name="l01192"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#ga267968271f1e5533c5a529a4bb452fe9"> 1192</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#ga267968271f1e5533c5a529a4bb452fe9">audiod_xfer_cb</a>(uint8_t rhport, uint8_t ep_addr, <a class="code" href="group___u_s_b_def___type.html#ga6a3b3a4d6801fd9b02feb0510c84e5f9">xfer_result_t</a> result, uint32_t xferred_bytes)</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;{</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  (void) result;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  (void) xferred_bytes;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160; </div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="comment">// Search for interface belonging to given end point address and proceed as required</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  uint8_t idxDriver;</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  <span class="keywordflow">for</span> (idxDriver = 0; idxDriver &lt; CFG_TUD_AUDIO; idxDriver++)</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  {</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_INT_CTR_EPSIZE_IN</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160; </div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <span class="comment">// Data transmission of control interrupt finished</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].ep_int_ctr == ep_addr)</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    {</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;      <span class="comment">// According to USB2 specification, maximum payload of interrupt EP is 8 bytes on low speed, 64 bytes on full speed, and 1024 bytes on high speed (but only if an alternate interface other than 0 is used - see specification p. 49)</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      <span class="comment">// In case there is nothing to send we have to return a NAK - this is taken care of by PHY ???</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      <span class="comment">// In case of an erroneous transmission a retransmission is conducted - this is taken care of by PHY ???</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160; </div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      <span class="comment">// Load new data</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      uint16 *n_bytes_copied;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      TU_VERIFY(<a class="code" href="audio__device_8c.html#ae066b3daf0858170fa840068e30ce6b3">audio_int_ctr_done_cb</a>(rhport, &amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver], n_bytes_copied));</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160; </div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      <span class="keywordflow">if</span> (*n_bytes_copied == 0 &amp;&amp; xferred_bytes &amp;&amp; (0 == (xferred_bytes % CFG_TUD_AUDIO_INT_CTR_EPSIZE_IN)))</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      {</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;        <span class="comment">// There is no data left to send, a ZLP should be sent if</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        <span class="comment">// xferred_bytes is multiple of EP size and not zero</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="usbd_8c.html#a381b55ad6eadb2bad7f95e2286dc50c9">usbd_edpt_xfer</a>(rhport, ep_addr, NULL, 0);</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      }</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    }</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160; </div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160; </div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_IN</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160; </div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="comment">// Data transmission of audio packet finished</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].ep_in == ep_addr)</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    {</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;      <span class="comment">// USB 2.0, section 5.6.4, third paragraph, states &quot;An isochronous endpoint must specify its required bus access period. However, an isochronous endpoint must be prepared to handle poll rates faster than the one specified.&quot;</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      <span class="comment">// That paragraph goes on to say &quot;An isochronous IN endpoint must return a zero-length packet whenever data is requested at a faster interval than the specified interval and data is not available.&quot;</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;      <span class="comment">// This can only be solved reliably if we load a ZLP after every IN transmission since we can not say if the host requests samples earlier than we declared! Once all samples are collected we overwrite the loaded ZLP.</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160; </div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      <span class="comment">// Check if there is data to load into EPs buffer - if not load it with ZLP</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;      <span class="comment">// Be aware - we as a device are not able to know if the host polls for data with a faster rate as we stated this in the descriptors. Therefore we always have to put something into the EPs buffer. However, once we did that, there is no way of aborting this or replacing what we put into the buffer before!</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      <span class="comment">// This is the only place where we can fill something into the EPs buffer!</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160; </div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;      <span class="comment">// Load new data</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      uint16_t n_bytes_copied;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;      TU_VERIFY(<a class="code" href="audio__device_8c.html#ab7f1ef914fa407dc1bacf820eadd97a1">audiod_tx_done_cb</a>(rhport, &amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver], &amp;n_bytes_copied));</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160; </div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      <span class="comment">// Transmission of ZLP is done by audiod_tx_done_cb()</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    }</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160; </div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_EPSIZE_OUT</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160; </div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="comment">// New audio packet received</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].ep_out == ep_addr)</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    {</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      <span class="comment">// Save into buffer - do whatever has to be done</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      TU_VERIFY(<a class="code" href="audio__device_8c.html#a2f20fe78d812f93eea18c622836a73a2">audio_rx_done_cb</a>(rhport, &amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver], <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].epout_buf, xferred_bytes));</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160; </div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      <span class="comment">// prepare for next transmission</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      TU_ASSERT(<a class="code" href="usbd_8c.html#a381b55ad6eadb2bad7f95e2286dc50c9">usbd_edpt_xfer</a>(rhport, ep_addr, <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].epout_buf, CFG_TUD_AUDIO_EPSIZE_OUT), <span class="keyword">false</span>);</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160; </div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    }</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160; </div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160; </div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_ENABLE_FEEDBACK_EP</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <span class="comment">// Transmission of feedback EP finished</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].ep_fb == ep_addr)</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    {</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___serial___device.html#ga5271289bd0ddf65bc4409ac95b5b612b">tud_audio_fb_done_cb</a>) TU_VERIFY(<a class="code" href="group___a_u_d_i_o___serial___device.html#ga5271289bd0ddf65bc4409ac95b5b612b">tud_audio_fb_done_cb</a>(rhport));</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160; </div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="audio__device_8c.html#a9cc6d9a3ec813e737a817bbaacc1290d">audio_fb_send</a>(rhport, &amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver]);</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    }</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  }</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160; </div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160; </div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;}</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160; </div>
<div class="line"><a name="l01278"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#ga174b50cfb8892143b096a48c3c2f1b80"> 1278</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#ga174b50cfb8892143b096a48c3c2f1b80">tud_audio_buffer_and_schedule_control_xfer</a>(uint8_t rhport, <a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_control_request_t</a> <span class="keyword">const</span> * p_request, <span class="keywordtype">void</span>* data, uint16_t len)</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;{</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="comment">// Handles only sending of data not receiving</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  <span class="keywordflow">if</span> (p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a840e65207ee03a571ad5d81fc0ec4fea">bmRequestType_bit</a>.direction == <a class="code" href="group___u_s_b_def___type.html#gga0c1b25b161b272f5f39e4ba49478289ca96d25fd7f8e59bc00cdfd0cbeaa285ae">TUSB_DIR_OUT</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160; </div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <span class="comment">// Get corresponding driver index</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  uint8_t idxDriver;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  uint8_t itf = TU_U16_LOW(p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a9d5ce5ef1272f91aaf9fc18e5d97b8f3">wIndex</a>);</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160; </div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="comment">// Conduct checks which depend on the recipient</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  <span class="keywordflow">switch</span> (p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a840e65207ee03a571ad5d81fc0ec4fea">bmRequestType_bit</a>.recipient)</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  {</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group___u_s_b_def___type.html#gga7edb52971e0f0a9fa25fbc3a55469a98ab7cd0143d8423e9520467d425ca88a7e">TUSB_REQ_RCPT_INTERFACE</a>: ;     <span class="comment">// The semicolon is there to enable a declaration right after the label</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160; </div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    uint8_t entityID = TU_U16_HIGH(p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a9d5ce5ef1272f91aaf9fc18e5d97b8f3">wIndex</a>);</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160; </div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <span class="comment">// Verify if entity is present</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="keywordflow">if</span> (entityID != 0)</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    {</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;      <span class="comment">// Find index of audio driver structure and verify entity really exists</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      TU_VERIFY(<a class="code" href="audio__device_8c.html#a965631c42a2f162557bea4ef61ce0ffa">audiod_verify_entity_exists</a>(itf, entityID, &amp;idxDriver));</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    }</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    {</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      <span class="comment">// Find index of audio driver structure and verify interface really exists</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;      TU_VERIFY(<a class="code" href="audio__device_8c.html#afaa85901b20e8953a0c55b2ed688466c">audiod_verify_itf_exists</a>(itf, &amp;idxDriver));</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    }</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160; </div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group___u_s_b_def___type.html#gga7edb52971e0f0a9fa25fbc3a55469a98a4c7af1856e9ce49fb1f971b7f1cac9c5">TUSB_REQ_RCPT_ENDPOINT</a>: ;      <span class="comment">// The semicolon is there to enable a declaration right after the label</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160; </div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    uint8_t ep = TU_U16_LOW(p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a9d5ce5ef1272f91aaf9fc18e5d97b8f3">wIndex</a>);</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160; </div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="comment">// Find index of audio driver structure and verify EP really exists</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    TU_VERIFY(<a class="code" href="audio__device_8c.html#ad19beb67377f7e649bf5cbfc3bbdca9c">audiod_verify_ep_exists</a>(ep, &amp;idxDriver));</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160; </div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <span class="comment">// Unknown/Unsupported recipient</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <span class="keywordflow">default</span>: TU_LOG2(<span class="stringliteral">&quot;  Unsupported recipient: %d\r\n&quot;</span>, p_request-&gt;<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a840e65207ee03a571ad5d81fc0ec4fea">bmRequestType_bit</a>.recipient); TU_BREAKPOINT(); <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  }</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160; </div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  <span class="comment">// Crop length</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;  <span class="keywordflow">if</span> (len &gt; CFG_TUD_AUDIO_CTRL_BUF_SIZE) len = CFG_TUD_AUDIO_CTRL_BUF_SIZE;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160; </div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  <span class="comment">// Copy into buffer</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  memcpy((<span class="keywordtype">void</span> *)<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].ctrl_buf, data, (<span class="keywordtype">size_t</span>)len);</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160; </div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  <span class="comment">// Schedule transmit</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="usbd_8h.html#a4e06b404ecb86635fe41f44b8bcb5401">tud_control_xfer</a>(rhport, p_request, (<span class="keywordtype">void</span>*)<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[idxDriver].ctrl_buf, len);</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;}</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160; </div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="comment">// This helper function finds for a given AS interface number the index of the attached driver structure, the index of the interface in the audio function</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="comment">// (e.g. the std. AS interface with interface number 15 is the first AS interface for the given audio function and thus gets index zero), and</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="comment">// finally a pointer to the std. AS interface, where the pointer always points to the first alternate setting i.e. alternate interface zero.</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"><a class="line" href="audio__device_8c.html#addcbf82fb684c80d4f2c22d0833fce44"> 1332</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#addcbf82fb684c80d4f2c22d0833fce44">audiod_get_AS_interface_index</a>(uint8_t itf, uint8_t *idxDriver, uint8_t *idxItf, uint8_t <span class="keyword">const</span> **pp_desc_int)</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;{</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <span class="comment">// Loop over audio driver interfaces</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  uint8_t i;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; CFG_TUD_AUDIO; i++)</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  {</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].p_desc)</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    {</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;      <span class="comment">// Get pointer at end</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;      uint8_t <span class="keyword">const</span> *p_desc_end = <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].<a class="code" href="structaudiod__interface__t.html#a6447ba0d0c6f3c0387556a9d0b35f22e">p_desc</a> + <a class="code" href="audio__device_8c.html#ac36d4c519e458a99d79a121eac59a5df">tud_audio_desc_lengths</a>[i] - TUD_AUDIO_DESC_IAD_LEN;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160; </div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;      <span class="comment">// Advance past AC descriptors</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      uint8_t <span class="keyword">const</span> *p_desc = <a class="code" href="group___u_s_b_def___type.html#gada5e96e4ab9e63c55e99f179085116f0">tu_desc_next</a>(<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].p_desc);</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;      p_desc += ((<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">audio_desc_cs_ac_interface_t</a> <span class="keyword">const</span> *)p_desc)-&gt;wTotalLength;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160; </div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;      uint8_t tmp = 0;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      <span class="keywordflow">while</span> (p_desc &lt; p_desc_end)</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      {</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        <span class="comment">// We assume the number of alternate settings is increasing thus we return the index of alternate setting zero!</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b_def___type.html#gaec3d617e38f349c026a4d2558d814513">tu_desc_type</a>(p_desc) == <a class="code" href="group___u_s_b_def___type.html#ggacb5e6c763fa4283e1be386759d1dfc13ae6894b69faf0ba905e3263cf93a999e4">TUSB_DESC_INTERFACE</a> &amp;&amp; ((<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_desc_interface_t</a> <span class="keyword">const</span> * )p_desc)-&gt;bInterfaceNumber == itf)</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        {</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;          *idxItf = tmp;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;          *idxDriver = i;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;          *pp_desc_int = p_desc;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        }</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160; </div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        <span class="comment">// Increase index, bytes read, and pointer</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        tmp++;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        p_desc = <a class="code" href="group___u_s_b_def___type.html#gada5e96e4ab9e63c55e99f179085116f0">tu_desc_next</a>(p_desc);</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;      }</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    }</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  }</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160; </div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;}</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160; </div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment">// Verify an entity with the given ID exists and returns also the corresponding driver index</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"><a class="line" href="audio__device_8c.html#a965631c42a2f162557bea4ef61ce0ffa"> 1370</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#a965631c42a2f162557bea4ef61ce0ffa">audiod_verify_entity_exists</a>(uint8_t itf, uint8_t entityID, uint8_t *idxDriver)</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;{</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  uint8_t i;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; CFG_TUD_AUDIO; i++)</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  {</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    <span class="comment">// Look for the correct driver by checking if the unique standard AC interface number fits</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].p_desc &amp;&amp; ((<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_desc_interface_t</a> <span class="keyword">const</span> *)<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].p_desc)-&gt;bInterfaceNumber == itf)</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    {</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      <span class="comment">// Get pointers after class specific AC descriptors and end of AC descriptors - entities are defined in between</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      uint8_t <span class="keyword">const</span> *p_desc = <a class="code" href="group___u_s_b_def___type.html#gada5e96e4ab9e63c55e99f179085116f0">tu_desc_next</a>(<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].p_desc);                                          <span class="comment">// Points to CS AC descriptor</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      uint8_t <span class="keyword">const</span> *p_desc_end = ((<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">audio_desc_cs_ac_interface_t</a> <span class="keyword">const</span> *)p_desc)-&gt;wTotalLength + p_desc;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;      p_desc = <a class="code" href="group___u_s_b_def___type.html#gada5e96e4ab9e63c55e99f179085116f0">tu_desc_next</a>(p_desc);                                                                            <span class="comment">// Get past CS AC descriptor</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160; </div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      <span class="keywordflow">while</span> (p_desc &lt; p_desc_end)</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      {</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        <span class="keywordflow">if</span> (p_desc[3] == entityID)  <span class="comment">// Entity IDs are always at offset 3</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;        {</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;          *idxDriver = i;</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        }</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        p_desc = <a class="code" href="group___u_s_b_def___type.html#gada5e96e4ab9e63c55e99f179085116f0">tu_desc_next</a>(p_desc);</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;      }</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    }</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  }</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;}</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160; </div>
<div class="line"><a name="l01397"></a><span class="lineno"><a class="line" href="audio__device_8c.html#afaa85901b20e8953a0c55b2ed688466c"> 1397</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#afaa85901b20e8953a0c55b2ed688466c">audiod_verify_itf_exists</a>(uint8_t itf, uint8_t *idxDriver)</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;{</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  uint8_t i;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; CFG_TUD_AUDIO; i++)</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  {</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].p_desc)</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    {</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;      <span class="comment">// Get pointer at beginning and end</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;      uint8_t <span class="keyword">const</span> *p_desc = <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].<a class="code" href="structaudiod__interface__t.html#a6447ba0d0c6f3c0387556a9d0b35f22e">p_desc</a>;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      uint8_t <span class="keyword">const</span> *p_desc_end = <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].<a class="code" href="structaudiod__interface__t.html#a6447ba0d0c6f3c0387556a9d0b35f22e">p_desc</a> + <a class="code" href="audio__device_8c.html#ac36d4c519e458a99d79a121eac59a5df">tud_audio_desc_lengths</a>[i] - TUD_AUDIO_DESC_IAD_LEN;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160; </div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      <span class="keywordflow">while</span> (p_desc &lt; p_desc_end)</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;      {</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b_def___type.html#gaec3d617e38f349c026a4d2558d814513">tu_desc_type</a>(p_desc) == <a class="code" href="group___u_s_b_def___type.html#ggacb5e6c763fa4283e1be386759d1dfc13ae6894b69faf0ba905e3263cf93a999e4">TUSB_DESC_INTERFACE</a> &amp;&amp; ((<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_desc_interface_t</a> <span class="keyword">const</span> *)<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].p_desc)-&gt;bInterfaceNumber == itf)</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        {</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;          *idxDriver = i;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        }</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        p_desc = <a class="code" href="group___u_s_b_def___type.html#gada5e96e4ab9e63c55e99f179085116f0">tu_desc_next</a>(p_desc);</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      }</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    }</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  }</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;}</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160; </div>
<div class="line"><a name="l01422"></a><span class="lineno"><a class="line" href="audio__device_8c.html#ad19beb67377f7e649bf5cbfc3bbdca9c"> 1422</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="audio__device_8c.html#ad19beb67377f7e649bf5cbfc3bbdca9c">audiod_verify_ep_exists</a>(uint8_t ep, uint8_t *idxDriver)</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;{</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  uint8_t i;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; CFG_TUD_AUDIO; i++)</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  {</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].p_desc)</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    {</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;      <span class="comment">// Get pointer at end</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      uint8_t <span class="keyword">const</span> *p_desc_end = <a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].<a class="code" href="structaudiod__interface__t.html#a6447ba0d0c6f3c0387556a9d0b35f22e">p_desc</a> + <a class="code" href="audio__device_8c.html#ac36d4c519e458a99d79a121eac59a5df">tud_audio_desc_lengths</a>[i];</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160; </div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      <span class="comment">// Advance past AC descriptors - EP we look for are streaming EPs</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      uint8_t <span class="keyword">const</span> *p_desc = <a class="code" href="group___u_s_b_def___type.html#gada5e96e4ab9e63c55e99f179085116f0">tu_desc_next</a>(<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[i].p_desc);</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      p_desc += ((<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">audio_desc_cs_ac_interface_t</a> <span class="keyword">const</span> *)p_desc)-&gt;wTotalLength;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160; </div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;      <span class="keywordflow">while</span> (p_desc &lt; p_desc_end)</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      {</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b_def___type.html#gaec3d617e38f349c026a4d2558d814513">tu_desc_type</a>(p_desc) == <a class="code" href="group___u_s_b_def___type.html#ggacb5e6c763fa4283e1be386759d1dfc13abab5f4629d2d2bf0fb2bd3189c1f02f3">TUSB_DESC_ENDPOINT</a> &amp;&amp; ((<a class="code" href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">tusb_desc_endpoint_t</a> <span class="keyword">const</span> * )p_desc)-&gt;bEndpointAddress == ep)</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        {</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;          *idxDriver = i;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        }</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;        p_desc = <a class="code" href="group___u_s_b_def___type.html#gada5e96e4ab9e63c55e99f179085116f0">tu_desc_next</a>(p_desc);</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;      }</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    }</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  }</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;}</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160; </div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="preprocessor">#if CFG_TUD_AUDIO_ENABLE_FEEDBACK_EP</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"><a class="line" href="group___a_u_d_i_o___serial___device.html#ga05fae042bda3ba6140e8f5819c282f1e"> 1451</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="group___a_u_d_i_o___serial___device.html#ga05fae042bda3ba6140e8f5819c282f1e">tud_audio_fb_set</a>(uint8_t rhport, uint32_t feedback)</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;{</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;  <a class="code" href="structaudiod__interface__t.html">audiod_interface_t</a> *audio = &amp;<a class="code" href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a>[0];</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160; </div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  audio-&gt;<a class="code" href="structaudiod__interface__t.html#aca1971fc878ae5d0725d81a67ce83e29">fb_val</a> = feedback;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;  TU_VERIFY(!<a class="code" href="usbd_8c.html#a66f04dcaad638cd71eb379c84cf5d4b8">usbd_edpt_busy</a>(rhport, audio-&gt;<a class="code" href="structaudiod__interface__t.html#a79b64e83989a2821c496dfad732563ef">ep_fb</a>), <span class="keyword">true</span>);</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160; </div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="audio__device_8c.html#a9cc6d9a3ec813e737a817bbaacc1290d">audio_fb_send</a>(rhport, audio);</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;}</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160; </div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="preprocessor">#endif </span><span class="comment">//TUSB_OPT_DEVICE_ENABLED &amp;&amp; CFG_TUD_AUDIO</span></div>
<div class="ttc" id="a_hid_command_interface_8h_html_a3f333b1c841dda37afbc4c28598a6fc5a10573b873d2fa5a365d558a45e328e47"><div class="ttname"><a href="_hid_command_interface_8h.html#a3f333b1c841dda37afbc4c28598a6fc5a10573b873d2fa5a365d558a45e328e47">HidCmdType::request</a></div><div class="ttdeci">@ request</div></div>
<div class="ttc" id="aaudio_8h_html"><div class="ttname"><a href="audio_8h.html">audio.h</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_a0422a57de30423fd529fd73cf3530a2b"><div class="ttname"><a href="audio__device_8c.html#a0422a57de30423fd529fd73cf3530a2b">audiod_tx_done_type_I_pcm_ff_cb</a></div><div class="ttdeci">static bool audiod_tx_done_type_I_pcm_ff_cb(uint8_t rhport, audiod_interface_t *audio)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00554">audio_device.c:554</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_a12f87dfd88ac7f27d136f1e8e18b47d7"><div class="ttname"><a href="audio__device_8c.html#a12f87dfd88ac7f27d136f1e8e18b47d7">audiod_control_request</a></div><div class="ttdeci">static bool audiod_control_request(uint8_t rhport, tusb_control_request_t const *p_request)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l01068">audio_device.c:1068</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_a157776477c001bdd60ea446c36032713"><div class="ttname"><a href="audio__device_8c.html#a157776477c001bdd60ea446c36032713">audiod_control_complete</a></div><div class="ttdeci">static bool audiod_control_complete(uint8_t rhport, tusb_control_request_t const *p_request)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00992">audio_device.c:992</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_a2f20fe78d812f93eea18c622836a73a2"><div class="ttname"><a href="audio__device_8c.html#a2f20fe78d812f93eea18c622836a73a2">audio_rx_done_cb</a></div><div class="ttdeci">static bool audio_rx_done_cb(uint8_t rhport, audiod_interface_t *audio, uint8_t *buffer, uint16_t bufsize)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00265">audio_device.c:265</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_a4bb141bbb7dceb4722cde99885f6bdd3"><div class="ttname"><a href="audio__device_8c.html#a4bb141bbb7dceb4722cde99885f6bdd3">tud_audio_int_ctr_n_write</a></div><div class="ttdeci">uint32_t tud_audio_int_ctr_n_write(uint8_t itf, uint8_t const *buffer, uint32_t bufsize)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00458">audio_device.c:458</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_a7abe0efec0cf613405fa2995d15b2c8e"><div class="ttname"><a href="audio__device_8c.html#a7abe0efec0cf613405fa2995d15b2c8e">audiod_set_interface</a></div><div class="ttdeci">static bool audiod_set_interface(uint8_t rhport, tusb_control_request_t const *p_request)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00848">audio_device.c:848</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_a95893a2600798eec6df171e4cd0b6e70"><div class="ttname"><a href="audio__device_8c.html#a95893a2600798eec6df171e4cd0b6e70">audiod_get_interface</a></div><div class="ttdeci">static bool audiod_get_interface(uint8_t rhport, tusb_control_request_t const *p_request)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00825">audio_device.c:825</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_a965631c42a2f162557bea4ef61ce0ffa"><div class="ttname"><a href="audio__device_8c.html#a965631c42a2f162557bea4ef61ce0ffa">audiod_verify_entity_exists</a></div><div class="ttdeci">static bool audiod_verify_entity_exists(uint8_t itf, uint8_t entityID, uint8_t *idxDriver)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l01370">audio_device.c:1370</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_a9cc6d9a3ec813e737a817bbaacc1290d"><div class="ttname"><a href="audio__device_8c.html#a9cc6d9a3ec813e737a817bbaacc1290d">audio_fb_send</a></div><div class="ttdeci">static bool audio_fb_send(uint8_t rhport, audiod_interface_t *audio)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00646">audio_device.c:646</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_ab57ea9af5181ba55643e9f8482d63f53"><div class="ttname"><a href="audio__device_8c.html#ab57ea9af5181ba55643e9f8482d63f53">_audiod_itf</a></div><div class="ttdeci">CFG_TUSB_MEM_SECTION audiod_interface_t _audiod_itf[CFG_TUD_AUDIO]</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00145">audio_device.c:145</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_ab7f1ef914fa407dc1bacf820eadd97a1"><div class="ttname"><a href="audio__device_8c.html#ab7f1ef914fa407dc1bacf820eadd97a1">audiod_tx_done_cb</a></div><div class="ttdeci">static bool audiod_tx_done_cb(uint8_t rhport, audiod_interface_t *audio, uint16_t *n_bytes_copied)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00475">audio_device.c:475</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_abc179677384302d76886a0144b332b14"><div class="ttname"><a href="audio__device_8c.html#abc179677384302d76886a0144b332b14">audio_rx_done_type_I_pcm_ff_cb</a></div><div class="ttdeci">static bool audio_rx_done_type_I_pcm_ff_cb(uint8_t rhport, audiod_interface_t *audio, uint8_t *buffer, uint16_t bufsize)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00314">audio_device.c:314</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_ac36d4c519e458a99d79a121eac59a5df"><div class="ttname"><a href="audio__device_8c.html#ac36d4c519e458a99d79a121eac59a5df">tud_audio_desc_lengths</a></div><div class="ttdeci">const uint16_t tud_audio_desc_lengths[]</div></div>
<div class="ttc" id="aaudio__device_8c_html_ad19beb67377f7e649bf5cbfc3bbdca9c"><div class="ttname"><a href="audio__device_8c.html#ad19beb67377f7e649bf5cbfc3bbdca9c">audiod_verify_ep_exists</a></div><div class="ttdeci">static bool audiod_verify_ep_exists(uint8_t ep, uint8_t *idxDriver)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l01422">audio_device.c:1422</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_addcbf82fb684c80d4f2c22d0833fce44"><div class="ttname"><a href="audio__device_8c.html#addcbf82fb684c80d4f2c22d0833fce44">audiod_get_AS_interface_index</a></div><div class="ttdeci">static bool audiod_get_AS_interface_index(uint8_t itf, uint8_t *idxDriver, uint8_t *idxItf, uint8_t const **pp_desc_int)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l01332">audio_device.c:1332</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_ae066b3daf0858170fa840068e30ce6b3"><div class="ttname"><a href="audio__device_8c.html#ae066b3daf0858170fa840068e30ce6b3">audio_int_ctr_done_cb</a></div><div class="ttdeci">static bool audio_int_ctr_done_cb(uint8_t rhport, audiod_interface_t *audio, uint16_t *n_bytes_copied)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00696">audio_device.c:696</a></div></div>
<div class="ttc" id="aaudio__device_8c_html_afaa85901b20e8953a0c55b2ed688466c"><div class="ttname"><a href="audio__device_8c.html#afaa85901b20e8953a0c55b2ed688466c">audiod_verify_itf_exists</a></div><div class="ttdeci">static bool audiod_verify_itf_exists(uint8_t itf, uint8_t *idxDriver)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l01397">audio_device.c:1397</a></div></div>
<div class="ttc" id="aaudio__device_8h_html"><div class="ttname"><a href="audio__device_8h.html">audio_device.h</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga0148a0cf485e6790ef7a51551ae8f550"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga0148a0cf485e6790ef7a51551ae8f550">tud_audio_int_ctr_n_available</a></div><div class="ttdeci">uint16_t tud_audio_int_ctr_n_available(uint8_t itf)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00243">audio_device.c:243</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga05dc4cf6537e042cceacbc9fddcf5bd4"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga05dc4cf6537e042cceacbc9fddcf5bd4">audiod_open</a></div><div class="ttdeci">uint16_t audiod_open(uint8_t rhport, tusb_desc_interface_t const *itf_desc, uint16_t max_len)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00784">audio_device.c:784</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga05fae042bda3ba6140e8f5819c282f1e"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga05fae042bda3ba6140e8f5819c282f1e">tud_audio_fb_set</a></div><div class="ttdeci">bool tud_audio_fb_set(uint8_t rhport, uint32_t feedback)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l01451">audio_device.c:1451</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga076a60dbc1b05ef987448adb78230550"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga076a60dbc1b05ef987448adb78230550">tud_audio_int_ctr_done_cb</a></div><div class="ttdeci">TU_ATTR_WEAK bool tud_audio_int_ctr_done_cb(uint8_t rhport, uint16_t *n_bytes_copied)</div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga174b50cfb8892143b096a48c3c2f1b80"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga174b50cfb8892143b096a48c3c2f1b80">tud_audio_buffer_and_schedule_control_xfer</a></div><div class="ttdeci">bool tud_audio_buffer_and_schedule_control_xfer(uint8_t rhport, tusb_control_request_t const *p_request, void *data, uint16_t len)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l01278">audio_device.c:1278</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga203ac09097d03c0e5669883120698746"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga203ac09097d03c0e5669883120698746">audiod_control_xfer_cb</a></div><div class="ttdeci">bool audiod_control_xfer_cb(uint8_t rhport, uint8_t stage, tusb_control_request_t const *request)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l01178">audio_device.c:1178</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga267968271f1e5533c5a529a4bb452fe9"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga267968271f1e5533c5a529a4bb452fe9">audiod_xfer_cb</a></div><div class="ttdeci">bool audiod_xfer_cb(uint8_t rhport, uint8_t ep_addr, xfer_result_t result, uint32_t xferred_bytes)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l01192">audio_device.c:1192</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga31c7902c0165c66fd615aa504bc6092e"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga31c7902c0165c66fd615aa504bc6092e">tud_audio_set_req_entity_cb</a></div><div class="ttdeci">TU_ATTR_WEAK bool tud_audio_set_req_entity_cb(uint8_t rhport, tusb_control_request_t const *p_request, uint8_t *pBuff)</div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga46f6e442bac9e7c0eae60f2f4eaa3719"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga46f6e442bac9e7c0eae60f2f4eaa3719">tud_audio_get_req_ep_cb</a></div><div class="ttdeci">TU_ATTR_WEAK bool tud_audio_get_req_ep_cb(uint8_t rhport, tusb_control_request_t const *p_request)</div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga4fa6dd742c1d1fd387767079876c8f19"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga4fa6dd742c1d1fd387767079876c8f19">audiod_init</a></div><div class="ttdeci">void audiod_init(void)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00721">audio_device.c:721</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga50d7441a11431fda3a05f765ad1fd19c"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga50d7441a11431fda3a05f765ad1fd19c">tud_audio_set_req_itf_cb</a></div><div class="ttdeci">TU_ATTR_WEAK bool tud_audio_set_req_itf_cb(uint8_t rhport, tusb_control_request_t const *p_request, uint8_t *pBuff)</div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga5271289bd0ddf65bc4409ac95b5b612b"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga5271289bd0ddf65bc4409ac95b5b612b">tud_audio_fb_done_cb</a></div><div class="ttdeci">TU_ATTR_WEAK bool tud_audio_fb_done_cb(uint8_t rhport)</div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga6939b9213de9c240c9a9f909fdcb71cb"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga6939b9213de9c240c9a9f909fdcb71cb">tud_audio_set_itf_close_EP_cb</a></div><div class="ttdeci">TU_ATTR_WEAK bool tud_audio_set_itf_close_EP_cb(uint8_t rhport, tusb_control_request_t const *p_request)</div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga6f4a5ca886d0b4c550d6b3c21cee2ec6"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga6f4a5ca886d0b4c550d6b3c21cee2ec6">tud_audio_n_write</a></div><div class="ttdeci">uint16_t tud_audio_n_write(uint8_t itf, void const *data, uint16_t len)</div><div class="ttdoc">Write data to EP in buffer.</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00417">audio_device.c:417</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga701b1052def1f2597f7dc03127cbf4b6"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga701b1052def1f2597f7dc03127cbf4b6">tud_audio_n_write_flush</a></div><div class="ttdeci">uint16_t tud_audio_n_write_flush(uint8_t itf)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00442">audio_device.c:442</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga94447dfe41f27fdde46871973a236886"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga94447dfe41f27fdde46871973a236886">audiod_reset</a></div><div class="ttdeci">void audiod_reset(uint8_t rhport)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00759">audio_device.c:759</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga99bd34b9716983f4d843257f867d8346"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga99bd34b9716983f4d843257f867d8346">tud_audio_int_ctr_n_read_flush</a></div><div class="ttdeci">void tud_audio_int_ctr_n_read_flush(uint8_t itf)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00253">audio_device.c:253</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga9b230f36e4810b0651d51254547006f8"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga9b230f36e4810b0651d51254547006f8">tud_audio_rx_done_cb</a></div><div class="ttdeci">TU_ATTR_WEAK bool tud_audio_rx_done_cb(uint8_t rhport, uint8_t *buffer, uint16_t bufsize)</div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_ga9dcd3251aee94442963d3db8cfbd2da7"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#ga9dcd3251aee94442963d3db8cfbd2da7">tud_audio_get_req_entity_cb</a></div><div class="ttdeci">TU_ATTR_WEAK bool tud_audio_get_req_entity_cb(uint8_t rhport, tusb_control_request_t const *p_request)</div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_gab03f527ee1d9292add5c419a47be4eeb"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#gab03f527ee1d9292add5c419a47be4eeb">tud_audio_n_read_flush</a></div><div class="ttdeci">void tud_audio_n_read_flush(uint8_t itf, uint8_t channelId)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00218">audio_device.c:218</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_gab5b14ae7f83445319d4f8a9de0f0522a"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#gab5b14ae7f83445319d4f8a9de0f0522a">tud_audio_set_req_ep_cb</a></div><div class="ttdeci">TU_ATTR_WEAK bool tud_audio_set_req_ep_cb(uint8_t rhport, tusb_control_request_t const *p_request, uint8_t *pBuff)</div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_gab6711bd57901e11458814bee53ab8d70"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#gab6711bd57901e11458814bee53ab8d70">tud_audio_n_mounted</a></div><div class="ttdeci">bool tud_audio_n_mounted(uint8_t itf)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00165">audio_device.c:165</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_gad07a937de93ff3ecf9ba8cda61a5d669"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#gad07a937de93ff3ecf9ba8cda61a5d669">tud_audio_n_read</a></div><div class="ttdeci">uint16_t tud_audio_n_read(uint8_t itf, uint8_t channelId, void *buffer, uint16_t bufsize)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00212">audio_device.c:212</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_gad5b147a3a0493d9747aea7045b2b348a"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#gad5b147a3a0493d9747aea7045b2b348a">tud_audio_int_ctr_n_read</a></div><div class="ttdeci">uint16_t tud_audio_int_ctr_n_read(uint8_t itf, void *buffer, uint16_t bufsize)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00248">audio_device.c:248</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_gad7616637a2b3366a58397aabbf4f4bda"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#gad7616637a2b3366a58397aabbf4f4bda">tud_audio_n_available</a></div><div class="ttdeci">uint16_t tud_audio_n_available(uint8_t itf, uint8_t channelId)</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00206">audio_device.c:206</a></div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_gadd76faa8f20f610f2b3d8742db0a4c9b"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#gadd76faa8f20f610f2b3d8742db0a4c9b">tud_audio_set_itf_cb</a></div><div class="ttdeci">TU_ATTR_WEAK bool tud_audio_set_itf_cb(uint8_t rhport, tusb_control_request_t const *p_request)</div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_gae1b3c4b0537996ce0510a2e6685a1510"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#gae1b3c4b0537996ce0510a2e6685a1510">tud_audio_tx_done_pre_load_cb</a></div><div class="ttdeci">TU_ATTR_WEAK bool tud_audio_tx_done_pre_load_cb(uint8_t rhport, uint8_t itf, uint8_t ep_in, uint8_t cur_alt_setting)</div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_gaf80121ee5456fc126cb4bd45b72e19c7"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#gaf80121ee5456fc126cb4bd45b72e19c7">tud_audio_get_req_itf_cb</a></div><div class="ttdeci">TU_ATTR_WEAK bool tud_audio_get_req_itf_cb(uint8_t rhport, tusb_control_request_t const *p_request)</div></div>
<div class="ttc" id="agroup___a_u_d_i_o___serial___device_html_gafcddd5b6cf7937c3a028fd49f0abe64c"><div class="ttname"><a href="group___a_u_d_i_o___serial___device.html#gafcddd5b6cf7937c3a028fd49f0abe64c">tud_audio_tx_done_post_load_cb</a></div><div class="ttdeci">TU_ATTR_WEAK bool tud_audio_tx_done_post_load_cb(uint8_t rhport, uint16_t n_bytes_copied, uint8_t itf, uint8_t ep_in, uint8_t cur_alt_setting)</div></div>
<div class="ttc" id="agroup___class_driver___audio_html_gga959777adfa0a40af13b50e0aec895428a88af25d50de4915c08ed6bf0b5ffe590"><div class="ttname"><a href="group___class_driver___audio.html#gga959777adfa0a40af13b50e0aec895428a88af25d50de4915c08ed6bf0b5ffe590">AUDIO_SUBCLASS_CONTROL</a></div><div class="ttdeci">@ AUDIO_SUBCLASS_CONTROL</div><div class="ttdoc">Audio Control.</div><div class="ttdef"><b>Definition:</b> <a href="audio_8h_source.html#l00061">audio.h:61</a></div></div>
<div class="ttc" id="agroup___class_driver___audio_html_ggac2b9f68f7beb6aa574692bc9223ad0bcae702c02fe9a3a601da33eca436d877e9"><div class="ttname"><a href="group___class_driver___audio.html#ggac2b9f68f7beb6aa574692bc9223ad0bcae702c02fe9a3a601da33eca436d877e9">AUDIO_INT_PROTOCOL_CODE_V2</a></div><div class="ttdeci">@ AUDIO_INT_PROTOCOL_CODE_V2</div><div class="ttdoc">Version 2.0.</div><div class="ttdef"><b>Definition:</b> <a href="audio_8h_source.html#l00070">audio.h:70</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_ga6a3b3a4d6801fd9b02feb0510c84e5f9"><div class="ttname"><a href="group___u_s_b_def___type.html#ga6a3b3a4d6801fd9b02feb0510c84e5f9">xfer_result_t</a></div><div class="ttdeci">xfer_result_t</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00222">tusb_types.h:223</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_gaaa353f2da73c8d7c4dda783341e4c681"><div class="ttname"><a href="group___u_s_b_def___type.html#gaaa353f2da73c8d7c4dda783341e4c681">tu_edpt_dir</a></div><div class="ttdeci">static tusb_dir_t tu_edpt_dir(uint8_t addr)</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00457">tusb_types.h:457</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_gada5e96e4ab9e63c55e99f179085116f0"><div class="ttname"><a href="group___u_s_b_def___type.html#gada5e96e4ab9e63c55e99f179085116f0">tu_desc_next</a></div><div class="ttdeci">static uint8_t const  * tu_desc_next(void const *desc)</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00476">tusb_types.h:476</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_gaec3d617e38f349c026a4d2558d814513"><div class="ttname"><a href="group___u_s_b_def___type.html#gaec3d617e38f349c026a4d2558d814513">tu_desc_type</a></div><div class="ttdeci">static uint8_t tu_desc_type(void const *desc)</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00482">tusb_types.h:482</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_gga0c1b25b161b272f5f39e4ba49478289ca29e402c2558d1a97a08294c5d1837444"><div class="ttname"><a href="group___u_s_b_def___type.html#gga0c1b25b161b272f5f39e4ba49478289ca29e402c2558d1a97a08294c5d1837444">TUSB_DIR_IN</a></div><div class="ttdeci">@ TUSB_DIR_IN</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00067">tusb_types.h:67</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_gga0c1b25b161b272f5f39e4ba49478289ca96d25fd7f8e59bc00cdfd0cbeaa285ae"><div class="ttname"><a href="group___u_s_b_def___type.html#gga0c1b25b161b272f5f39e4ba49478289ca96d25fd7f8e59bc00cdfd0cbeaa285ae">TUSB_DIR_OUT</a></div><div class="ttdeci">@ TUSB_DIR_OUT</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00066">tusb_types.h:66</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_gga0ce8a24b63587d1b3ad6a73d53b9b5d7ac058b37d5d6c5248a1cd8799fabc04e9"><div class="ttname"><a href="group___u_s_b_def___type.html#gga0ce8a24b63587d1b3ad6a73d53b9b5d7ac058b37d5d6c5248a1cd8799fabc04e9">TUSB_REQ_SET_INTERFACE</a></div><div class="ttdeci">@ TUSB_REQ_SET_INTERFACE</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00116">tusb_types.h:116</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_gga0ce8a24b63587d1b3ad6a73d53b9b5d7ac587684c81349834555732484f643930"><div class="ttname"><a href="group___u_s_b_def___type.html#gga0ce8a24b63587d1b3ad6a73d53b9b5d7ac587684c81349834555732484f643930">TUSB_REQ_GET_INTERFACE</a></div><div class="ttdeci">@ TUSB_REQ_GET_INTERFACE</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00115">tusb_types.h:115</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_gga163997b8e3d823786be70e2f192e87f6a1c0286b14f0983947cb58639aa254bd8"><div class="ttname"><a href="group___u_s_b_def___type.html#gga163997b8e3d823786be70e2f192e87f6a1c0286b14f0983947cb58639aa254bd8">TUSB_CLASS_AUDIO</a></div><div class="ttdeci">@ TUSB_CLASS_AUDIO</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00147">tusb_types.h:147</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_gga7edb52971e0f0a9fa25fbc3a55469a98a4c7af1856e9ce49fb1f971b7f1cac9c5"><div class="ttname"><a href="group___u_s_b_def___type.html#gga7edb52971e0f0a9fa25fbc3a55469a98a4c7af1856e9ce49fb1f971b7f1cac9c5">TUSB_REQ_RCPT_ENDPOINT</a></div><div class="ttdeci">@ TUSB_REQ_RCPT_ENDPOINT</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00139">tusb_types.h:139</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_gga7edb52971e0f0a9fa25fbc3a55469a98ab7cd0143d8423e9520467d425ca88a7e"><div class="ttname"><a href="group___u_s_b_def___type.html#gga7edb52971e0f0a9fa25fbc3a55469a98ab7cd0143d8423e9520467d425ca88a7e">TUSB_REQ_RCPT_INTERFACE</a></div><div class="ttdeci">@ TUSB_REQ_RCPT_INTERFACE</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00138">tusb_types.h:138</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_ggaaf105ae5beaca1dee30ae54530691fceae5d89e21948588e11d6564fdf0e66c0b"><div class="ttname"><a href="group___u_s_b_def___type.html#ggaaf105ae5beaca1dee30ae54530691fceae5d89e21948588e11d6564fdf0e66c0b">CONTROL_STAGE_DATA</a></div><div class="ttdeci">@ CONTROL_STAGE_DATA</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00257">tusb_types.h:257</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_ggaaf105ae5beaca1dee30ae54530691fceaf17ae8688f98708446ce909eb0e83c7c"><div class="ttname"><a href="group___u_s_b_def___type.html#ggaaf105ae5beaca1dee30ae54530691fceaf17ae8688f98708446ce909eb0e83c7c">CONTROL_STAGE_SETUP</a></div><div class="ttdeci">@ CONTROL_STAGE_SETUP</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00256">tusb_types.h:256</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_ggabbeae90d995af4a347e21ab82eec9456a1a5d5e44e508347c79fe9785308a8ce7"><div class="ttname"><a href="group___u_s_b_def___type.html#ggabbeae90d995af4a347e21ab82eec9456a1a5d5e44e508347c79fe9785308a8ce7">TUSB_REQ_TYPE_STANDARD</a></div><div class="ttdeci">@ TUSB_REQ_TYPE_STANDARD</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00129">tusb_types.h:129</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_ggabbeae90d995af4a347e21ab82eec9456abe22791174a5bf81fd550e340aae7d12"><div class="ttname"><a href="group___u_s_b_def___type.html#ggabbeae90d995af4a347e21ab82eec9456abe22791174a5bf81fd550e340aae7d12">TUSB_REQ_TYPE_CLASS</a></div><div class="ttdeci">@ TUSB_REQ_TYPE_CLASS</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00130">tusb_types.h:130</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_ggacb5e6c763fa4283e1be386759d1dfc13abab5f4629d2d2bf0fb2bd3189c1f02f3"><div class="ttname"><a href="group___u_s_b_def___type.html#ggacb5e6c763fa4283e1be386759d1dfc13abab5f4629d2d2bf0fb2bd3189c1f02f3">TUSB_DESC_ENDPOINT</a></div><div class="ttdeci">@ TUSB_DESC_ENDPOINT</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00079">tusb_types.h:79</a></div></div>
<div class="ttc" id="agroup___u_s_b_def___type_html_ggacb5e6c763fa4283e1be386759d1dfc13ae6894b69faf0ba905e3263cf93a999e4"><div class="ttname"><a href="group___u_s_b_def___type.html#ggacb5e6c763fa4283e1be386759d1dfc13ae6894b69faf0ba905e3263cf93a999e4">TUSB_DESC_INTERFACE</a></div><div class="ttdeci">@ TUSB_DESC_INTERFACE</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00078">tusb_types.h:78</a></div></div>
<div class="ttc" id="agroup__group__fifo_html_ga0653c4e3af5b0b2766ff72264f5836b7"><div class="ttname"><a href="group__group__fifo.html#ga0653c4e3af5b0b2766ff72264f5836b7">tu_fifo_count</a></div><div class="ttdeci">uint16_t tu_fifo_count(tu_fifo_t *f)</div><div class="ttdoc">Get number of items in FIFO.</div><div class="ttdef"><b>Definition:</b> <a href="tusb__fifo_8c_source.html#l00298">tusb_fifo.c:298</a></div></div>
<div class="ttc" id="agroup__group__fifo_html_ga10af7f477229b0dbff381107d6c96e59"><div class="ttname"><a href="group__group__fifo.html#ga10af7f477229b0dbff381107d6c96e59">tu_fifo_config_mutex</a></div><div class="ttdeci">static void tu_fifo_config_mutex(tu_fifo_t *f, tu_fifo_mutex_t mutex_hdl)</div><div class="ttdef"><b>Definition:</b> <a href="tusb__fifo_8h_source.html#l00100">tusb_fifo.h:100</a></div></div>
<div class="ttc" id="agroup__group__fifo_html_ga4dfb40d48350bdff5c7f47321703d886"><div class="ttname"><a href="group__group__fifo.html#ga4dfb40d48350bdff5c7f47321703d886">tu_fifo_config</a></div><div class="ttdeci">bool tu_fifo_config(tu_fifo_t *f, void *buffer, uint16_t depth, uint16_t item_size, bool overwritable)</div><div class="ttdef"><b>Definition:</b> <a href="tusb__fifo_8c_source.html#l00065">tusb_fifo.c:65</a></div></div>
<div class="ttc" id="agroup__group__fifo_html_ga87bb1cdf2a8fa5c16e12dded661c8890"><div class="ttname"><a href="group__group__fifo.html#ga87bb1cdf2a8fa5c16e12dded661c8890">tu_fifo_write_n</a></div><div class="ttdeci">uint16_t tu_fifo_write_n(tu_fifo_t *f, const void *data, uint16_t count)</div><div class="ttdoc">This function will write n elements into the array index specified by the write pointer and increment...</div><div class="ttdef"><b>Definition:</b> <a href="tusb__fifo_8c_source.html#l00550">tusb_fifo.c:550</a></div></div>
<div class="ttc" id="agroup__group__fifo_html_gac2550100e64724b1c1e29fe59735499d"><div class="ttname"><a href="group__group__fifo.html#gac2550100e64724b1c1e29fe59735499d">tu_fifo_read_n</a></div><div class="ttdeci">uint16_t tu_fifo_read_n(tu_fifo_t *f, void *buffer, uint16_t count)</div><div class="ttdoc">This function will read n elements from the array index specified by the read pointer and increment t...</div><div class="ttdef"><b>Definition:</b> <a href="tusb__fifo_8c_source.html#l00437">tusb_fifo.c:437</a></div></div>
<div class="ttc" id="agroup__group__fifo_html_gaf629a02b7f0b2dc380bfdc1d8ca05723"><div class="ttname"><a href="group__group__fifo.html#gaf629a02b7f0b2dc380bfdc1d8ca05723">tu_fifo_clear</a></div><div class="ttdeci">bool tu_fifo_clear(tu_fifo_t *f)</div><div class="ttdoc">Clear the fifo read and write pointers.</div><div class="ttdef"><b>Definition:</b> <a href="tusb__fifo_8c_source.html#l00597">tusb_fifo.c:597</a></div></div>
<div class="ttc" id="aosal_8h_html_a6f2721e8b6bb1100d20d5e65fb9506a2"><div class="ttname"><a href="osal_8h.html#a6f2721e8b6bb1100d20d5e65fb9506a2">osal_mutex_create</a></div><div class="ttdeci">static osal_mutex_t osal_mutex_create(osal_mutex_def_t *mdef)</div></div>
<div class="ttc" id="aosal__freertos_8h_html_a5930f7a2cc6f2bb374dea58f7256f943"><div class="ttname"><a href="osal__freertos_8h.html#a5930f7a2cc6f2bb374dea58f7256f943">osal_mutex_def_t</a></div><div class="ttdeci">StaticSemaphore_t osal_mutex_def_t</div><div class="ttdef"><b>Definition:</b> <a href="osal__freertos_8h_source.html#l00094">osal_freertos.h:94</a></div></div>
<div class="ttc" id="astruct_t_u___a_t_t_r___p_a_c_k_e_d_html"><div class="ttname"><a href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html">TU_ATTR_PACKED</a></div><div class="ttdoc">AUDIO Channel Cluster Descriptor (4.1)</div><div class="ttdef"><b>Definition:</b> <a href="audio_8h_source.html#l00675">audio.h:675</a></div></div>
<div class="ttc" id="astruct_t_u___a_t_t_r___p_a_c_k_e_d_html_a5464b2036f01c887759f3ee05fbea7e5"><div class="ttname"><a href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a5464b2036f01c887759f3ee05fbea7e5">TU_ATTR_PACKED::wValue</a></div><div class="ttdeci">uint16_t wValue</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00439">tusb_types.h:439</a></div></div>
<div class="ttc" id="astruct_t_u___a_t_t_r___p_a_c_k_e_d_html_a840e65207ee03a571ad5d81fc0ec4fea"><div class="ttname"><a href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a840e65207ee03a571ad5d81fc0ec4fea">TU_ATTR_PACKED::bmRequestType_bit</a></div><div class="ttdeci">struct TU_ATTR_PACKED::@22::TU_ATTR_PACKED bmRequestType_bit</div></div>
<div class="ttc" id="astruct_t_u___a_t_t_r___p_a_c_k_e_d_html_a9d5ce5ef1272f91aaf9fc18e5d97b8f3"><div class="ttname"><a href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#a9d5ce5ef1272f91aaf9fc18e5d97b8f3">TU_ATTR_PACKED::wIndex</a></div><div class="ttdeci">uint16_t wIndex</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00440">tusb_types.h:440</a></div></div>
<div class="ttc" id="astruct_t_u___a_t_t_r___p_a_c_k_e_d_html_aadd38c49cc1af3f056eba046eb9fed9d"><div class="ttname"><a href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#aadd38c49cc1af3f056eba046eb9fed9d">TU_ATTR_PACKED::bInterfaceClass</a></div><div class="ttdeci">uint8_t bInterfaceClass</div><div class="ttdoc">Class code (assigned by the USB-IF).</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00321">tusb_types.h:321</a></div></div>
<div class="ttc" id="astruct_t_u___a_t_t_r___p_a_c_k_e_d_html_ace0fdf8430d37ab5190b296d619432f2"><div class="ttname"><a href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#ace0fdf8430d37ab5190b296d619432f2">TU_ATTR_PACKED::bInterfaceSubClass</a></div><div class="ttdeci">uint8_t bInterfaceSubClass</div><div class="ttdoc">Subclass code (assigned by the USB-IF).   These codes are qualified by the value of the bInterfaceCla...</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00322">tusb_types.h:322</a></div></div>
<div class="ttc" id="astruct_t_u___a_t_t_r___p_a_c_k_e_d_html_ad5dff13a5439a91a41750025ce2b8a73"><div class="ttname"><a href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#ad5dff13a5439a91a41750025ce2b8a73">TU_ATTR_PACKED::bRequest</a></div><div class="ttdeci">uint8_t bRequest</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00438">tusb_types.h:438</a></div></div>
<div class="ttc" id="astruct_t_u___a_t_t_r___p_a_c_k_e_d_html_ae33ee9029d2e2ca9e33a4ac8e8b0610b"><div class="ttname"><a href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#ae33ee9029d2e2ca9e33a4ac8e8b0610b">TU_ATTR_PACKED::bNumEndpoints</a></div><div class="ttdeci">uint8_t bNumEndpoints</div><div class="ttdoc">Number of endpoints used by this interface (excluding endpoint zero). If this value is zero,...</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00320">tusb_types.h:320</a></div></div>
<div class="ttc" id="astruct_t_u___a_t_t_r___p_a_c_k_e_d_html_ae547f66a4366cf0b4800c5f709b1568a"><div class="ttname"><a href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#ae547f66a4366cf0b4800c5f709b1568a">TU_ATTR_PACKED::bInterfaceProtocol</a></div><div class="ttdeci">uint8_t bInterfaceProtocol</div><div class="ttdoc">Protocol code (assigned by the USB).   These codes are qualified by the value of the bInterfaceClass ...</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00323">tusb_types.h:323</a></div></div>
<div class="ttc" id="astruct_t_u___a_t_t_r___p_a_c_k_e_d_html_af2550553f18c20966282846f2fa548bc"><div class="ttname"><a href="struct_t_u___a_t_t_r___p_a_c_k_e_d.html#af2550553f18c20966282846f2fa548bc">TU_ATTR_PACKED::bAlternateSetting</a></div><div class="ttdeci">uint8_t bAlternateSetting</div><div class="ttdoc">Value used to select this alternate setting for the interface identified in the prior field.</div><div class="ttdef"><b>Definition:</b> <a href="tusb__types_8h_source.html#l00319">tusb_types.h:319</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html"><div class="ttname"><a href="structaudiod__interface__t.html">audiod_interface_t</a></div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00062">audio_device.c:63</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_a0b6985b3138bea86dafe037071eff704"><div class="ttname"><a href="structaudiod__interface__t.html#a0b6985b3138bea86dafe037071eff704">audiod_interface_t::ep_out_as_intf_num</a></div><div class="ttdeci">uint8_t ep_out_as_intf_num</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00075">audio_device.c:75</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_a1e7250e29ffe799e7e614e7334299471"><div class="ttname"><a href="structaudiod__interface__t.html#a1e7250e29ffe799e7e614e7334299471">audiod_interface_t::epin_buf</a></div><div class="ttdeci">CFG_TUSB_MEM_ALIGN uint8_t epin_buf[CFG_TUD_AUDIO_EPSIZE_IN]</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00131">audio_device.c:131</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_a26eadf826c08e25eced602925238224b"><div class="ttname"><a href="structaudiod__interface__t.html#a26eadf826c08e25eced602925238224b">audiod_interface_t::rhport</a></div><div class="ttdeci">uint8_t rhport</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00064">audio_device.c:64</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_a2d66b7cda27cdb10981693940bff5887"><div class="ttname"><a href="structaudiod__interface__t.html#a2d66b7cda27cdb10981693940bff5887">audiod_interface_t::epin_buf_cnt</a></div><div class="ttdeci">uint16_t epin_buf_cnt</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00069">audio_device.c:69</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_a4803234e5365a68c80be0e704823bef1"><div class="ttname"><a href="structaudiod__interface__t.html#a4803234e5365a68c80be0e704823bef1">audiod_interface_t::rx_ff_buf</a></div><div class="ttdeci">CFG_TUSB_MEM_ALIGN uint8_t rx_ff_buf[CFG_TUD_AUDIO_RX_FIFO_COUNT][CFG_TUD_AUDIO_RX_FIFO_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00106">audio_device.c:106</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_a4822da41b42dcf15bf73364bea0565f2"><div class="ttname"><a href="structaudiod__interface__t.html#a4822da41b42dcf15bf73364bea0565f2">audiod_interface_t::ep_in_as_intf_num</a></div><div class="ttdeci">uint8_t ep_in_as_intf_num</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00070">audio_device.c:70</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_a4d4468ca5402d897306f260a9d8fda16"><div class="ttname"><a href="structaudiod__interface__t.html#a4d4468ca5402d897306f260a9d8fda16">audiod_interface_t::int_ctr_ff_mutex</a></div><div class="ttdeci">osal_mutex_def_t int_ctr_ff_mutex</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00116">audio_device.c:116</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_a6447ba0d0c6f3c0387556a9d0b35f22e"><div class="ttname"><a href="structaudiod__interface__t.html#a6447ba0d0c6f3c0387556a9d0b35f22e">audiod_interface_t::p_desc</a></div><div class="ttdeci">uint8_t const  * p_desc</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00065">audio_device.c:65</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_a6d80c8df994755d6bda4b74c5feb4c55"><div class="ttname"><a href="structaudiod__interface__t.html#a6d80c8df994755d6bda4b74c5feb4c55">audiod_interface_t::ep_in</a></div><div class="ttdeci">uint8_t ep_in</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00068">audio_device.c:68</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_a6f525368d2d6d9cf8416edc2a067c3b8"><div class="ttname"><a href="structaudiod__interface__t.html#a6f525368d2d6d9cf8416edc2a067c3b8">audiod_interface_t::altSetting</a></div><div class="ttdeci">uint8_t altSetting[CFG_TUD_AUDIO_N_AS_INT]</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00088">audio_device.c:88</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_a7847aaafa32aa3ef13f6b58fa747467b"><div class="ttname"><a href="structaudiod__interface__t.html#a7847aaafa32aa3ef13f6b58fa747467b">audiod_interface_t::ep_int_ctr_buf</a></div><div class="ttdeci">CFG_TUSB_MEM_ALIGN uint8_t ep_int_ctr_buf[CFG_TUD_AUDIO_INT_CTR_EPSIZE_IN]</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00135">audio_device.c:135</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_a79b64e83989a2821c496dfad732563ef"><div class="ttname"><a href="structaudiod__interface__t.html#a79b64e83989a2821c496dfad732563ef">audiod_interface_t::ep_fb</a></div><div class="ttdeci">uint8_t ep_fb</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00078">audio_device.c:78</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_a7a101747bf0a4cc519fc472c4fa683ef"><div class="ttname"><a href="structaudiod__interface__t.html#a7a101747bf0a4cc519fc472c4fa683ef">audiod_interface_t::int_ctr_ff_buf</a></div><div class="ttdeci">CFG_TUSB_MEM_ALIGN uint8_t int_ctr_ff_buf[CFG_TUD_AUDIO_INT_CTR_BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00114">audio_device.c:114</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_aa718168a12b7112d4d9a4a6847d580e0"><div class="ttname"><a href="structaudiod__interface__t.html#aa718168a12b7112d4d9a4a6847d580e0">audiod_interface_t::int_ctr_ff</a></div><div class="ttdeci">tu_fifo_t int_ctr_ff</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00113">audio_device.c:113</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_aabf94bbb03fb61a7f821cb3b19eee159"><div class="ttname"><a href="structaudiod__interface__t.html#aabf94bbb03fb61a7f821cb3b19eee159">audiod_interface_t::ep_int_ctr</a></div><div class="ttdeci">uint8_t ep_int_ctr</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00084">audio_device.c:84</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_ab0d6da4e705a63123e4d1170157231ff"><div class="ttname"><a href="structaudiod__interface__t.html#ab0d6da4e705a63123e4d1170157231ff">audiod_interface_t::rx_ff</a></div><div class="ttdeci">tu_fifo_t rx_ff[CFG_TUD_AUDIO_RX_FIFO_COUNT]</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00105">audio_device.c:105</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_ab86fe42db2fa6ef7d85918ecd302eaec"><div class="ttname"><a href="structaudiod__interface__t.html#ab86fe42db2fa6ef7d85918ecd302eaec">audiod_interface_t::tx_ff_buf</a></div><div class="ttdeci">CFG_TUSB_MEM_ALIGN uint8_t tx_ff_buf[CFG_TUD_AUDIO_TX_FIFO_COUNT][CFG_TUD_AUDIO_TX_FIFO_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00098">audio_device.c:98</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_abae241b79effc5e4a34753cb5873fc09"><div class="ttname"><a href="structaudiod__interface__t.html#abae241b79effc5e4a34753cb5873fc09">audiod_interface_t::tx_ff</a></div><div class="ttdeci">tu_fifo_t tx_ff[CFG_TUD_AUDIO_TX_FIFO_COUNT]</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00097">audio_device.c:97</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_ac88cb4873bc4b6b55341a7356d8c74a1"><div class="ttname"><a href="structaudiod__interface__t.html#ac88cb4873bc4b6b55341a7356d8c74a1">audiod_interface_t::rx_ff_mutex</a></div><div class="ttdeci">osal_mutex_def_t rx_ff_mutex[CFG_TUD_AUDIO_RX_FIFO_COUNT]</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00108">audio_device.c:108</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_aca1971fc878ae5d0725d81a67ce83e29"><div class="ttname"><a href="structaudiod__interface__t.html#aca1971fc878ae5d0725d81a67ce83e29">audiod_interface_t::fb_val</a></div><div class="ttdeci">uint32_t fb_val</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00125">audio_device.c:125</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_ad6374eb5e7c83a8dec7a16bf7d61f199"><div class="ttname"><a href="structaudiod__interface__t.html#ad6374eb5e7c83a8dec7a16bf7d61f199">audiod_interface_t::ep_out</a></div><div class="ttdeci">uint8_t ep_out</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00074">audio_device.c:74</a></div></div>
<div class="ttc" id="astructaudiod__interface__t_html_aefbedc5757f6a36a611d84c54a787955"><div class="ttname"><a href="structaudiod__interface__t.html#aefbedc5757f6a36a611d84c54a787955">audiod_interface_t::tx_ff_mutex</a></div><div class="ttdeci">osal_mutex_def_t tx_ff_mutex[CFG_TUD_AUDIO_TX_FIFO_COUNT]</div><div class="ttdef"><b>Definition:</b> <a href="audio__device_8c_source.html#l00100">audio_device.c:100</a></div></div>
<div class="ttc" id="astructtu__fifo__t_html"><div class="ttname"><a href="structtu__fifo__t.html">tu_fifo_t</a></div><div class="ttdoc">Simple Circular FIFO.</div><div class="ttdef"><b>Definition:</b> <a href="tusb__fifo_8h_source.html#l00062">tusb_fifo.h:63</a></div></div>
<div class="ttc" id="atusb__option_8h_html"><div class="ttname"><a href="tusb__option_8h.html">tusb_option.h</a></div></div>
<div class="ttc" id="ausbd_8c_html_a2acfc7062ccd10892583c6c674e27757"><div class="ttname"><a href="usbd_8c.html#a2acfc7062ccd10892583c6c674e27757">usbd_edpt_clear_stall</a></div><div class="ttdeci">void usbd_edpt_clear_stall(uint8_t rhport, uint8_t ep_addr)</div><div class="ttdef"><b>Definition:</b> <a href="usbd_8c_source.html#l01264">usbd.c:1264</a></div></div>
<div class="ttc" id="ausbd_8c_html_a2f04a6c0936ebf2d3015103dbd83153d"><div class="ttname"><a href="usbd_8c.html#a2f04a6c0936ebf2d3015103dbd83153d">usbd_edpt_close</a></div><div class="ttdeci">void usbd_edpt_close(uint8_t rhport, uint8_t ep_addr)</div><div class="ttdef"><b>Definition:</b> <a href="usbd_8c_source.html#l01290">usbd.c:1290</a></div></div>
<div class="ttc" id="ausbd_8c_html_a381b55ad6eadb2bad7f95e2286dc50c9"><div class="ttname"><a href="usbd_8c.html#a381b55ad6eadb2bad7f95e2286dc50c9">usbd_edpt_xfer</a></div><div class="ttdeci">bool usbd_edpt_xfer(uint8_t rhport, uint8_t ep_addr, uint8_t *buffer, uint16_t total_bytes)</div><div class="ttdef"><b>Definition:</b> <a href="usbd_8c_source.html#l01215">usbd.c:1215</a></div></div>
<div class="ttc" id="ausbd_8c_html_a406b8e3f5527c4ca9b545e538b4181e9"><div class="ttname"><a href="usbd_8c.html#a406b8e3f5527c4ca9b545e538b4181e9">usbd_edpt_open</a></div><div class="ttdeci">bool usbd_edpt_open(uint8_t rhport, tusb_desc_endpoint_t const *desc_ep)</div><div class="ttdef"><b>Definition:</b> <a href="usbd_8c_source.html#l01124">usbd.c:1124</a></div></div>
<div class="ttc" id="ausbd_8c_html_a66f04dcaad638cd71eb379c84cf5d4b8"><div class="ttname"><a href="usbd_8c.html#a66f04dcaad638cd71eb379c84cf5d4b8">usbd_edpt_busy</a></div><div class="ttdeci">bool usbd_edpt_busy(uint8_t rhport, uint8_t ep_addr)</div><div class="ttdef"><b>Definition:</b> <a href="usbd_8c_source.html#l01244">usbd.c:1244</a></div></div>
<div class="ttc" id="ausbd_8h_html_a4e06b404ecb86635fe41f44b8bcb5401"><div class="ttname"><a href="usbd_8h.html#a4e06b404ecb86635fe41f44b8bcb5401">tud_control_xfer</a></div><div class="ttdeci">bool tud_control_xfer(uint8_t rhport, tusb_control_request_t const *request, void *buffer, uint16_t len)</div><div class="ttdef"><b>Definition:</b> <a href="usbd__control_8c_source.html#l00104">usbd_control.c:104</a></div></div>
<div class="ttc" id="ausbd_8h_html_ac6d1facfa117d185b95666a4ffe9810f"><div class="ttname"><a href="usbd_8h.html#ac6d1facfa117d185b95666a4ffe9810f">tud_control_status</a></div><div class="ttdeci">bool tud_control_status(uint8_t rhport, tusb_control_request_t const *request)</div><div class="ttdef"><b>Definition:</b> <a href="usbd__control_8c_source.html#l00074">usbd_control.c:74</a></div></div>
<div class="ttc" id="ausbd__pvt_8h_html"><div class="ttname"><a href="usbd__pvt_8h.html">usbd_pvt.h</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_3a581ba30d25676e4b797b1f96d53b45.html">F:</a></li><li class="navelem"><a class="el" href="dir_975a1ec9ea70940b35b923ccf23c9bec.html">ST</a></li><li class="navelem"><a class="el" href="dir_525e87a6917975b1d68139368320c4ea.html">OpenFFBoard</a></li><li class="navelem"><a class="el" href="dir_b580f62eba9dd5173208471d11e04add.html">Firmware</a></li><li class="navelem"><a class="el" href="dir_e411f5bae134b4a2c689177a7cfced91.html">FFBoard</a></li><li class="navelem"><a class="el" href="dir_179538452af84d8dfd42ebc9206999d3.html">USB</a></li><li class="navelem"><a class="el" href="dir_7b7e5ec42116771b0e2bd177b0a6ffd2.html">class</a></li><li class="navelem"><a class="el" href="dir_80a06299751e52201a316f6c045a3e93.html">audio</a></li><li class="navelem"><a class="el" href="audio__device_8c.html">audio_device.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
